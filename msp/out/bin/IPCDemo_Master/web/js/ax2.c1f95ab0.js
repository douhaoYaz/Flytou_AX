(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ax2"],{"0b25":function(e,t,n){var r=n("a691"),i=n("50c4");e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length or index");return n}},"145e":function(e,t,n){"use strict";var r=n("7b0b"),i=n("23cb"),a=n("50c4"),o=Math.min;e.exports=[].copyWithin||function(e,t){var n=r(this),s=a(n.length),c=i(e,s),l=i(t,s),u=arguments.length>2?arguments[2]:void 0,d=o((void 0===u?s:i(u,s))-l,s-c),f=1;l<c&&c<l+d&&(f=-1,l+=d-1,c+=d-1);while(d-- >0)l in n?n[c]=n[l]:delete n[c],c+=f,l+=f;return n}},"14c3":function(e,t,n){var r=n("c6b6"),i=n("9263");e.exports=function(e,t){var n=e.exec;if("function"===typeof n){var a=n.call(e,t);if("object"!==typeof a)throw TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==r(e))throw TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},"159b":function(e,t,n){var r=n("da84"),i=n("fdbc"),a=n("17c2"),o=n("9112");for(var s in i){var c=r[s],l=c&&c.prototype;if(l&&l.forEach!==a)try{o(l,"forEach",a)}catch(u){l.forEach=a}}},"170b":function(e,t,n){"use strict";var r=n("ebb5"),i=n("50c4"),a=n("23cb"),o=n("4840"),s=r.aTypedArray,c=r.exportTypedArrayMethod;c("subarray",(function(e,t){var n=s(this),r=n.length,c=a(e,r);return new(o(n,n.constructor))(n.buffer,n.byteOffset+c*n.BYTES_PER_ELEMENT,i((void 0===t?r:a(t,r))-c))}))},"17c2":function(e,t,n){"use strict";var r=n("b727").forEach,i=n("a640"),a=n("ae40"),o=i("forEach"),s=a("forEach");e.exports=o&&s?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},"182d":function(e,t,n){var r=n("f8cd");e.exports=function(e,t){var n=r(e);if(n%t)throw RangeError("Wrong offset");return n}},"219c":function(e,t,n){"use strict";var r=n("ebb5"),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=[].sort;a("sort",(function(e){return o.call(i(this),e)}))},"25a1":function(e,t,n){"use strict";var r=n("ebb5"),i=n("d58f").right,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("reduceRight",(function(e){return i(a(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},2954:function(e,t,n){"use strict";var r=n("ebb5"),i=n("4840"),a=n("d039"),o=r.aTypedArray,s=r.aTypedArrayConstructor,c=r.exportTypedArrayMethod,l=[].slice,u=a((function(){new Int8Array(1).slice()}));c("slice",(function(e,t){var n=l.call(o(this),e,t),r=i(this,this.constructor),a=0,c=n.length,u=new(s(r))(c);while(c>a)u[a]=n[a++];return u}),u)},3280:function(e,t,n){"use strict";var r=n("ebb5"),i=n("e58c"),a=r.aTypedArray,o=r.exportTypedArrayMethod;o("lastIndexOf",(function(e){return i.apply(a(this),arguments)}))},3410:function(e,t,n){var r=n("23e7"),i=n("d039"),a=n("7b0b"),o=n("e163"),s=n("e177"),c=i((function(){o(1)}));r({target:"Object",stat:!0,forced:c,sham:!s},{getPrototypeOf:function(e){return o(a(e))}})},"3a7b":function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").findIndex,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("findIndex",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},"3c5d":function(e,t,n){"use strict";var r=n("ebb5"),i=n("50c4"),a=n("182d"),o=n("7b0b"),s=n("d039"),c=r.aTypedArray,l=r.exportTypedArrayMethod,u=s((function(){new Int8Array(1).set({})}));l("set",(function(e){c(this);var t=a(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=o(e),s=i(r.length),l=0;if(s+t>n)throw RangeError("Wrong length");while(l<s)this[t+l]=r[l++]}),u)},"3fcc":function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").map,a=n("4840"),o=r.aTypedArray,s=r.aTypedArrayConstructor,c=r.exportTypedArrayMethod;c("map",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(s(a(e,e.constructor)))(t)}))}))},4160:function(e,t,n){"use strict";var r=n("23e7"),i=n("17c2");r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},"466d":function(e,t,n){"use strict";var r=n("d784"),i=n("825a"),a=n("50c4"),o=n("1d80"),s=n("8aa5"),c=n("14c3");r("match",1,(function(e,t,n){return[function(t){var n=o(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var o=i(e),l=String(this);if(!o.global)return c(o,l);var u=o.unicode;o.lastIndex=0;var d,f=[],h=0;while(null!==(d=c(o,l))){var p=String(d[0]);f[h]=p,""===p&&(o.lastIndex=s(l,a(o.lastIndex),u)),h++}return 0===h?null:f}]}))},"4a9b":function(e,t,n){var r=n("74e8");r("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},5319:function(e,t,n){"use strict";var r=n("d784"),i=n("825a"),a=n("7b0b"),o=n("50c4"),s=n("a691"),c=n("1d80"),l=n("8aa5"),u=n("14c3"),d=Math.max,f=Math.min,h=Math.floor,p=/\$([$&'`]|\d\d?|<[^>]*>)/g,y=/\$([$&'`]|\d\d?)/g,m=function(e){return void 0===e?e:String(e)};r("replace",2,(function(e,t,n,r){var g=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,v=r.REPLACE_KEEPS_$0,b=g?"$":"$0";return[function(n,r){var i=c(this),a=void 0==n?void 0:n[e];return void 0!==a?a.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!g&&v||"string"===typeof r&&-1===r.indexOf(b)){var a=n(t,e,this,r);if(a.done)return a.value}var c=i(e),h=String(this),p="function"===typeof r;p||(r=String(r));var y=c.global;if(y){var _=c.unicode;c.lastIndex=0}var E=[];while(1){var S=u(c,h);if(null===S)break;if(E.push(S),!y)break;var T=String(S[0]);""===T&&(c.lastIndex=l(h,o(c.lastIndex),_))}for(var A="",k=0,R=0;R<E.length;R++){S=E[R];for(var x=String(S[0]),I=d(f(s(S.index),h.length),0),C=[],D=1;D<S.length;D++)C.push(m(S[D]));var O=S.groups;if(p){var U=[x].concat(C,I,h);void 0!==O&&U.push(O);var P=String(r.apply(void 0,U))}else P=w(x,h,I,C,O,r);I>=k&&(A+=h.slice(k,I)+P,k=I+x.length)}return A+h.slice(k)}];function w(e,n,r,i,o,s){var c=r+e.length,l=i.length,u=y;return void 0!==o&&(o=a(o),u=p),t.call(s,u,(function(t,a){var s;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(c);case"<":s=o[a.slice(1,-1)];break;default:var u=+a;if(0===u)return t;if(u>l){var d=h(u/10);return 0===d?t:d<=l?void 0===i[d-1]?a.charAt(1):i[d-1]+a.charAt(1):t}s=i[u-1]}return void 0===s?"":s}))}}))},5377:function(e,t,n){var r=n("83ab"),i=n("9bf2"),a=n("ad6d"),o=n("9f7f").UNSUPPORTED_Y;r&&("g"!=/./g.flags||o)&&i.f(RegExp.prototype,"flags",{configurable:!0,get:a})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,n){var r=n("1d80"),i=n("5899"),a="["+i+"]",o=RegExp("^"+a+a+"*"),s=RegExp(a+a+"*$"),c=function(e){return function(t){var n=String(r(t));return 1&e&&(n=n.replace(o,"")),2&e&&(n=n.replace(s,"")),n}};e.exports={start:c(1),end:c(2),trim:c(3)}},"5cc6":function(e,t,n){var r=n("74e8");r("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"5f96":function(e,t,n){"use strict";var r=n("ebb5"),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=[].join;a("join",(function(e){return o.apply(i(this),arguments)}))},"60bd":function(e,t,n){"use strict";var r=n("da84"),i=n("ebb5"),a=n("e260"),o=n("b622"),s=o("iterator"),c=r.Uint8Array,l=a.values,u=a.keys,d=a.entries,f=i.aTypedArray,h=i.exportTypedArrayMethod,p=c&&c.prototype[s],y=!!p&&("values"==p.name||void 0==p.name),m=function(){return l.call(f(this))};h("entries",(function(){return d.call(f(this))})),h("keys",(function(){return u.call(f(this))})),h("values",m,!y),h(s,m,!y)},"621a":function(e,t,n){"use strict";var r=n("da84"),i=n("83ab"),a=n("a981"),o=n("9112"),s=n("e2cc"),c=n("d039"),l=n("19aa"),u=n("a691"),d=n("50c4"),f=n("0b25"),h=n("77a7"),p=n("e163"),y=n("d2bb"),m=n("241c").f,g=n("9bf2").f,v=n("81d5"),b=n("d44e"),w=n("69f3"),_=w.get,E=w.set,S="ArrayBuffer",T="DataView",A="prototype",k="Wrong length",R="Wrong index",x=r[S],I=x,C=r[T],D=C&&C[A],O=Object.prototype,U=r.RangeError,P=h.pack,M=h.unpack,F=function(e){return[255&e]},L=function(e){return[255&e,e>>8&255]},N=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},B=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},G=function(e){return P(e,23,4)},j=function(e){return P(e,52,8)},V=function(e,t){g(e[A],t,{get:function(){return _(this)[t]}})},H=function(e,t,n,r){var i=f(n),a=_(e);if(i+t>a.byteLength)throw U(R);var o=_(a.buffer).bytes,s=i+a.byteOffset,c=o.slice(s,s+t);return r?c:c.reverse()},z=function(e,t,n,r,i,a){var o=f(n),s=_(e);if(o+t>s.byteLength)throw U(R);for(var c=_(s.buffer).bytes,l=o+s.byteOffset,u=r(+i),d=0;d<t;d++)c[l+d]=u[a?d:t-d-1]};if(a){if(!c((function(){x(1)}))||!c((function(){new x(-1)}))||c((function(){return new x,new x(1.5),new x(NaN),x.name!=S}))){I=function(e){return l(this,I),new x(f(e))};for(var W,q=I[A]=x[A],$=m(x),K=0;$.length>K;)(W=$[K++])in I||o(I,W,x[W]);q.constructor=I}y&&p(D)!==O&&y(D,O);var Y=new C(new I(2)),X=D.setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||s(D,{setInt8:function(e,t){X.call(this,e,t<<24>>24)},setUint8:function(e,t){X.call(this,e,t<<24>>24)}},{unsafe:!0})}else I=function(e){l(this,I,S);var t=f(e);E(this,{bytes:v.call(new Array(t),0),byteLength:t}),i||(this.byteLength=t)},C=function(e,t,n){l(this,C,T),l(e,I,T);var r=_(e).byteLength,a=u(t);if(a<0||a>r)throw U("Wrong offset");if(n=void 0===n?r-a:d(n),a+n>r)throw U(k);E(this,{buffer:e,byteLength:n,byteOffset:a}),i||(this.buffer=e,this.byteLength=n,this.byteOffset=a)},i&&(V(I,"byteLength"),V(C,"buffer"),V(C,"byteLength"),V(C,"byteOffset")),s(C[A],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return B(H(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return B(H(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return M(H(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return M(H(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){z(this,1,e,F,t)},setUint8:function(e,t){z(this,1,e,F,t)},setInt16:function(e,t){z(this,2,e,L,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){z(this,2,e,L,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){z(this,4,e,N,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){z(this,4,e,N,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){z(this,4,e,G,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){z(this,8,e,j,t,arguments.length>2?arguments[2]:void 0)}});b(I,S),b(C,T),e.exports={ArrayBuffer:I,DataView:C}},"649e":function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").some,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("some",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},7037:function(e,t,n){function r(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=r=function(e){return typeof e}:e.exports=r=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(t)}n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),e.exports=r},7156:function(e,t,n){var r=n("861d"),i=n("d2bb");e.exports=function(e,t,n){var a,o;return i&&"function"==typeof(a=t.constructor)&&a!==n&&r(o=a.prototype)&&o!==n.prototype&&i(e,o),e}},"72f7":function(e,t,n){"use strict";var r=n("ebb5").exportTypedArrayMethod,i=n("d039"),a=n("da84"),o=a.Uint8Array,s=o&&o.prototype||{},c=[].toString,l=[].join;i((function(){c.call({})}))&&(c=function(){return l.call(this)});var u=s.toString!=c;r("toString",c,u)},"735e":function(e,t,n){"use strict";var r=n("ebb5"),i=n("81d5"),a=r.aTypedArray,o=r.exportTypedArrayMethod;o("fill",(function(e){return i.apply(a(this),arguments)}))},"74e8":function(e,t,n){"use strict";var r=n("23e7"),i=n("da84"),a=n("83ab"),o=n("8aa7"),s=n("ebb5"),c=n("621a"),l=n("19aa"),u=n("5c6c"),d=n("9112"),f=n("50c4"),h=n("0b25"),p=n("182d"),y=n("c04e"),m=n("5135"),g=n("f5df"),v=n("861d"),b=n("7c73"),w=n("d2bb"),_=n("241c").f,E=n("a078"),S=n("b727").forEach,T=n("2626"),A=n("9bf2"),k=n("06cf"),R=n("69f3"),x=n("7156"),I=R.get,C=R.set,D=A.f,O=k.f,U=Math.round,P=i.RangeError,M=c.ArrayBuffer,F=c.DataView,L=s.NATIVE_ARRAY_BUFFER_VIEWS,N=s.TYPED_ARRAY_TAG,B=s.TypedArray,G=s.TypedArrayPrototype,j=s.aTypedArrayConstructor,V=s.isTypedArray,H="BYTES_PER_ELEMENT",z="Wrong length",W=function(e,t){var n=0,r=t.length,i=new(j(e))(r);while(r>n)i[n]=t[n++];return i},q=function(e,t){D(e,t,{get:function(){return I(this)[t]}})},$=function(e){var t;return e instanceof M||"ArrayBuffer"==(t=g(e))||"SharedArrayBuffer"==t},K=function(e,t){return V(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Y=function(e,t){return K(e,t=y(t,!0))?u(2,e[t]):O(e,t)},X=function(e,t,n){return!(K(e,t=y(t,!0))&&v(n)&&m(n,"value"))||m(n,"get")||m(n,"set")||n.configurable||m(n,"writable")&&!n.writable||m(n,"enumerable")&&!n.enumerable?D(e,t,n):(e[t]=n.value,e)};a?(L||(k.f=Y,A.f=X,q(G,"buffer"),q(G,"byteOffset"),q(G,"byteLength"),q(G,"length")),r({target:"Object",stat:!0,forced:!L},{getOwnPropertyDescriptor:Y,defineProperty:X}),e.exports=function(e,t,n){var a=e.match(/\d+$/)[0]/8,s=e+(n?"Clamped":"")+"Array",c="get"+e,u="set"+e,y=i[s],m=y,g=m&&m.prototype,A={},k=function(e,t){var n=I(e);return n.view[c](t*a+n.byteOffset,!0)},R=function(e,t,r){var i=I(e);n&&(r=(r=U(r))<0?0:r>255?255:255&r),i.view[u](t*a+i.byteOffset,r,!0)},O=function(e,t){D(e,t,{get:function(){return k(this,t)},set:function(e){return R(this,t,e)},enumerable:!0})};L?o&&(m=t((function(e,t,n,r){return l(e,m,s),x(function(){return v(t)?$(t)?void 0!==r?new y(t,p(n,a),r):void 0!==n?new y(t,p(n,a)):new y(t):V(t)?W(m,t):E.call(m,t):new y(h(t))}(),e,m)})),w&&w(m,B),S(_(y),(function(e){e in m||d(m,e,y[e])})),m.prototype=g):(m=t((function(e,t,n,r){l(e,m,s);var i,o,c,u=0,d=0;if(v(t)){if(!$(t))return V(t)?W(m,t):E.call(m,t);i=t,d=p(n,a);var y=t.byteLength;if(void 0===r){if(y%a)throw P(z);if(o=y-d,o<0)throw P(z)}else if(o=f(r)*a,o+d>y)throw P(z);c=o/a}else c=h(t),o=c*a,i=new M(o);C(e,{buffer:i,byteOffset:d,byteLength:o,length:c,view:new F(i)});while(u<c)O(e,u++)})),w&&w(m,B),g=m.prototype=b(G)),g.constructor!==m&&d(g,"constructor",m),N&&d(g,N,s),A[s]=m,r({global:!0,forced:m!=y,sham:!L},A),H in m||d(m,H,a),H in g||d(g,H,a),T(s)}):e.exports=function(){}},"77a7":function(e,t){var n=1/0,r=Math.abs,i=Math.pow,a=Math.floor,o=Math.log,s=Math.LN2,c=function(e,t,c){var l,u,d,f=new Array(c),h=8*c-t-1,p=(1<<h)-1,y=p>>1,m=23===t?i(2,-24)-i(2,-77):0,g=e<0||0===e&&1/e<0?1:0,v=0;for(e=r(e),e!=e||e===n?(u=e!=e?1:0,l=p):(l=a(o(e)/s),e*(d=i(2,-l))<1&&(l--,d*=2),e+=l+y>=1?m/d:m*i(2,1-y),e*d>=2&&(l++,d/=2),l+y>=p?(u=0,l=p):l+y>=1?(u=(e*d-1)*i(2,t),l+=y):(u=e*i(2,y-1)*i(2,t),l=0));t>=8;f[v++]=255&u,u/=256,t-=8);for(l=l<<t|u,h+=t;h>0;f[v++]=255&l,l/=256,h-=8);return f[--v]|=128*g,f},l=function(e,t){var r,a=e.length,o=8*a-t-1,s=(1<<o)-1,c=s>>1,l=o-7,u=a-1,d=e[u--],f=127&d;for(d>>=7;l>0;f=256*f+e[u],u--,l-=8);for(r=f&(1<<-l)-1,f>>=-l,l+=t;l>0;r=256*r+e[u],u--,l-=8);if(0===f)f=1-c;else{if(f===s)return r?NaN:d?-n:n;r+=i(2,t),f-=c}return(d?-1:1)*r*i(2,f-t)};e.exports={pack:c,unpack:l}},"81d5":function(e,t,n){"use strict";var r=n("7b0b"),i=n("23cb"),a=n("50c4");e.exports=function(e){var t=r(this),n=a(t.length),o=arguments.length,s=i(o>1?arguments[1]:void 0,n),c=o>2?arguments[2]:void 0,l=void 0===c?n:i(c,n);while(l>s)t[s++]=e;return t}},"82f8":function(e,t,n){"use strict";var r=n("ebb5"),i=n("4d64").includes,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("includes",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},"8aa5":function(e,t,n){"use strict";var r=n("6547").charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},"8aa7":function(e,t,n){var r=n("da84"),i=n("d039"),a=n("1c7e"),o=n("ebb5").NATIVE_ARRAY_BUFFER_VIEWS,s=r.ArrayBuffer,c=r.Int8Array;e.exports=!o||!i((function(){c(1)}))||!i((function(){new c(-1)}))||!a((function(e){new c,new c(null),new c(1.5),new c(e)}),!0)||i((function(){return 1!==new c(new s(2),1,void 0).length}))},"8aff":function(e,t,n){"use strict";n("ed15")},9263:function(e,t,n){"use strict";var r=n("ad6d"),i=n("9f7f"),a=RegExp.prototype.exec,o=String.prototype.replace,s=a,c=function(){var e=/a/,t=/b*/g;return a.call(e,"a"),a.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),l=i.UNSUPPORTED_Y||i.BROKEN_CARET,u=void 0!==/()??/.exec("")[1],d=c||u||l;d&&(s=function(e){var t,n,i,s,d=this,f=l&&d.sticky,h=r.call(d),p=d.source,y=0,m=e;return f&&(h=h.replace("y",""),-1===h.indexOf("g")&&(h+="g"),m=String(e).slice(d.lastIndex),d.lastIndex>0&&(!d.multiline||d.multiline&&"\n"!==e[d.lastIndex-1])&&(p="(?: "+p+")",m=" "+m,y++),n=new RegExp("^(?:"+p+")",h)),u&&(n=new RegExp("^"+p+"$(?!\\s)",h)),c&&(t=d.lastIndex),i=a.call(f?n:d,m),f?i?(i.input=i.input.slice(y),i[0]=i[0].slice(y),i.index=d.lastIndex,d.lastIndex+=i[0].length):d.lastIndex=0:c&&i&&(d.lastIndex=d.global?i.index+i[0].length:t),u&&i&&i.length>1&&o.call(i[0],n,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0)})),i}),e.exports=s},"93bf":function(e,t,n){
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var t="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},n=e.exports,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,a={};r<i;r++)if(e=n[r],e&&e[1]in t){for(r=0;r<e.length;r++)a[n[0][r]]=e[r];return a}return!1}(),i={change:r.fullscreenchange,error:r.fullscreenerror},a={request:function(e){return new Promise(function(n,i){var a=function(){this.off("change",a),n()}.bind(this);this.on("change",a),e=e||t.documentElement;var o=e[r.requestFullscreen]();o instanceof Promise&&o.then(a).catch(i)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var i=function(){this.off("change",i),e()}.bind(this);this.on("change",i);var a=t[r.exitFullscreen]();a instanceof Promise&&a.then(i).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=i[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=i[e];r&&t.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(a,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),n?e.exports=a:window.screenfull=a):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()},"99af":function(e,t,n){"use strict";var r=n("23e7"),i=n("d039"),a=n("e8b5"),o=n("861d"),s=n("7b0b"),c=n("50c4"),l=n("8418"),u=n("65f0"),d=n("1dde"),f=n("b622"),h=n("2d00"),p=f("isConcatSpreadable"),y=9007199254740991,m="Maximum allowed index exceeded",g=h>=51||!i((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),v=d("concat"),b=function(e){if(!o(e))return!1;var t=e[p];return void 0!==t?!!t:a(e)},w=!g||!v;r({target:"Array",proto:!0,forced:w},{concat:function(e){var t,n,r,i,a,o=s(this),d=u(o,0),f=0;for(t=-1,r=arguments.length;t<r;t++)if(a=-1===t?o:arguments[t],b(a)){if(i=c(a.length),f+i>y)throw TypeError(m);for(n=0;n<i;n++,f++)n in a&&l(d,f,a[n])}else{if(f>=y)throw TypeError(m);l(d,f++,a)}return d.length=f,d}})},"9a8c":function(e,t,n){"use strict";var r=n("ebb5"),i=n("145e"),a=r.aTypedArray,o=r.exportTypedArrayMethod;o("copyWithin",(function(e,t){return i.call(a(this),e,t,arguments.length>2?arguments[2]:void 0)}))},"9f7f":function(e,t,n){"use strict";var r=n("d039");function i(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=r((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=r((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},a078:function(e,t,n){var r=n("7b0b"),i=n("50c4"),a=n("35a1"),o=n("e95a"),s=n("0366"),c=n("ebb5").aTypedArrayConstructor;e.exports=function(e){var t,n,l,u,d,f,h=r(e),p=arguments.length,y=p>1?arguments[1]:void 0,m=void 0!==y,g=a(h);if(void 0!=g&&!o(g)){d=g.call(h),f=d.next,h=[];while(!(u=f.call(d)).done)h.push(u.value)}for(m&&p>2&&(y=s(y,arguments[2],2)),n=i(h.length),l=new(c(this))(n),t=0;n>t;t++)l[t]=m?y(h[t],t):h[t];return l}},a434:function(e,t,n){"use strict";var r=n("23e7"),i=n("23cb"),a=n("a691"),o=n("50c4"),s=n("7b0b"),c=n("65f0"),l=n("8418"),u=n("1dde"),d=n("ae40"),f=u("splice"),h=d("splice",{ACCESSORS:!0,0:0,1:2}),p=Math.max,y=Math.min,m=9007199254740991,g="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!f||!h},{splice:function(e,t){var n,r,u,d,f,h,v=s(this),b=o(v.length),w=i(e,b),_=arguments.length;if(0===_?n=r=0:1===_?(n=0,r=b-w):(n=_-2,r=y(p(a(t),0),b-w)),b+n-r>m)throw TypeError(g);for(u=c(v,r),d=0;d<r;d++)f=w+d,f in v&&l(u,d,v[f]);if(u.length=r,n<r){for(d=w;d<b-r;d++)f=d+r,h=d+n,f in v?v[h]=v[f]:delete v[h];for(d=b;d>b-r+n;d--)delete v[d-1]}else if(n>r)for(d=b-r;d>w;d--)f=d+r-1,h=d+n-1,f in v?v[h]=v[f]:delete v[h];for(d=0;d<n;d++)v[d+w]=arguments[d+2];return v.length=b-r+n,u}})},a975:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").every,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("every",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},a981:function(e,t){e.exports="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof DataView},a9e3:function(e,t,n){"use strict";var r=n("83ab"),i=n("da84"),a=n("94ca"),o=n("6eeb"),s=n("5135"),c=n("c6b6"),l=n("7156"),u=n("c04e"),d=n("d039"),f=n("7c73"),h=n("241c").f,p=n("06cf").f,y=n("9bf2").f,m=n("58a8").trim,g="Number",v=i[g],b=v.prototype,w=c(f(b))==g,_=function(e){var t,n,r,i,a,o,s,c,l=u(e,!1);if("string"==typeof l&&l.length>2)if(l=m(l),t=l.charCodeAt(0),43===t||45===t){if(n=l.charCodeAt(2),88===n||120===n)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(a=l.slice(2),o=a.length,s=0;s<o;s++)if(c=a.charCodeAt(s),c<48||c>i)return NaN;return parseInt(a,r)}return+l};if(a(g,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var E,S=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof S&&(w?d((function(){b.valueOf.call(n)})):c(n)!=g)?l(new v(_(t)),n,S):_(t)},T=r?h(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),A=0;T.length>A;A++)s(v,E=T[A])&&!s(S,E)&&y(S,E,p(v,E));S.prototype=b,b.constructor=S,o(i,g,S)}},ac1f:function(e,t,n){"use strict";var r=n("23e7"),i=n("9263");r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},b39a:function(e,t,n){"use strict";var r=n("da84"),i=n("ebb5"),a=n("d039"),o=r.Int8Array,s=i.aTypedArray,c=i.exportTypedArrayMethod,l=[].toLocaleString,u=[].slice,d=!!o&&a((function(){l.call(new o(1))})),f=a((function(){return[1,2].toLocaleString()!=new o([1,2]).toLocaleString()}))||!a((function(){o.prototype.toLocaleString.call([1,2])}));c("toLocaleString",(function(){return l.apply(d?u.call(s(this)):s(this),arguments)}),f)},b64b:function(e,t,n){var r=n("23e7"),i=n("7b0b"),a=n("df75"),o=n("d039"),s=o((function(){a(1)}));r({target:"Object",stat:!0,forced:s},{keys:function(e){return a(i(e))}})},c19f:function(e,t,n){"use strict";var r=n("23e7"),i=n("da84"),a=n("621a"),o=n("2626"),s="ArrayBuffer",c=a[s],l=i[s];r({global:!0,forced:l!==c},{ArrayBuffer:c}),o(s)},c1ac:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").filter,a=n("4840"),o=r.aTypedArray,s=r.aTypedArrayConstructor,c=r.exportTypedArrayMethod;c("filter",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0),n=a(this,this.constructor),r=0,c=t.length,l=new(s(n))(c);while(c>r)l[r]=t[r++];return l}))},ca91:function(e,t,n){"use strict";var r=n("ebb5"),i=n("d58f").left,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("reduce",(function(e){return i(a(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},cd26:function(e,t,n){"use strict";var r=n("ebb5"),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=Math.floor;a("reverse",(function(){var e,t=this,n=i(t).length,r=o(n/2),a=0;while(a<r)e=t[a],t[a++]=t[--n],t[n]=e;return t}))},cfc3:function(e,t,n){var r=n("74e8");r("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},d022:function(e,t,n){var r,i,a,o;n("a4d3"),n("e01a"),n("d28b"),n("99af"),n("4160"),n("c975"),n("fb6a"),n("a434"),n("c19f"),n("b0c0"),n("3410"),n("b64b"),n("d3b7"),n("ac1f"),n("5377"),n("25f0"),n("3ca3"),n("466d"),n("5319"),n("cfc3"),n("4a9b"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("ddb0"),n("2b3d");var s=n("7037");(function(n){"object"===s(t)&&"undefined"!==typeof e?e.exports=n():(i=[],r=n,a="function"===typeof r?r.apply(t,i):r,void 0===a||(e.exports=a))})((function(){var e;return function(){function e(t,n,r){function i(s,c){if(!n[s]){if(!t[s]){var l="function"==typeof o&&o;if(!c&&l)return o(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[s]={exports:{}};t[s][0].call(d.exports,(function(e){var n=t[s][1][e];return i(n||e)}),d,d.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof o&&o,s=0;s<r.length;s++)i(r[s]);return i}return e}()({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"===typeof e}function a(e){return"number"===typeof e}function o(e){return"object"===s(e)&&null!==e}function c(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,s,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(n=this._events[e],c(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,s=0;s<r;s++)l[s].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=c(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)while(n.length)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../errors"),a=e("../events"),o=f(a),c=e("../event-handler"),l=f(c),u=e("./fix-webm-duration"),d=f(u);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==s(t)&&"function"!==typeof t?e:t}function y(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+s(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e){function t(e){h(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default.MEDIA_ATTACHING,o.default.BUFFER_APPENDING,o.default.BUFFER_RESET,o.default.RECORDING_START,o.default.RECORDING_STOP));return n.rec_threshold_total=17179869184,n.rec_threshold_single=1073741824,n.rec_mimeType="video/webm",n.rec_blobType="video/webm",n.rec_file_ext=".webm",n.rec_timer=void 0,n.rec_start_tm=0,n.rec_file="",n.rec_result_cb=void 0,n.rec_state_cb=void 0,n.mediaSource=null,n.mediaRecorder=null,n.mediaParts=[],n.mediaSize=0,n.media=null,n.pendingTracks={},n.sourceBuffer={},n.segments=[],n.appended=0,n._msDuration=null,n.mediaErrorCount=0,n.count=0,n.onsbue=n.onSBUpdateEnd.bind(n),n.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(n.browserType=1),n.mediaType="",n.websocketName=void 0,n.channelName=void 0,n._fs=null,n}return y(t,e),r(t,[{key:"destroy",value:function(){l.default.prototype.destroy.call(this)}},{key:"pad2",value:function(e){return e<10?"0"+e:e}},{key:"onRecordingProc",value:function(){var e=this;if(null==e._fs)return e.rec_result_cb&&e.rec_result_cb(!1),void console.log("fs is not authorized");e.rec_timer&&(clearInterval(e.rec_timer),e.rec_timer=void 0),e.count=0,e.rec_timer=setInterval((function(){if(""==e.mediaType||"H264Raw"==e.mediaType&&e.appended>10){clearInterval(e.rec_timer),e.rec_timer=void 0;var t=new Date,n=1900+t.getYear()+"-"+e.pad2(t.getMonth()+1)+"-"+e.pad2(t.getDate())+"_"+e.pad2(t.getHours())+"-"+e.pad2(t.getMinutes())+"-"+e.pad2(t.getSeconds());e.rec_file="ax_"+n+e.rec_file_ext,e.mediaParts=[],e.mediaSize=0,e.mediaRecorder=new MediaRecorder(e.wfs.media.captureStream(),{mimeType:e.rec_mimeType}),e.mediaRecorder.start(500),e.rec_start_tm=Date.now(),e.mediaRecorder.ondataavailable=function(t){var n=t.data;n&&n.size>0&&(e.mediaParts.push(n),e.mediaSize+=n.size,e.mediaSize>=e.rec_threshold_single&&(e.rec_state_cb&&e.rec_state_cb(!1),e.onRecordingStop(),e.onRecordingStart(),e.rec_state_cb&&e.rec_state_cb(!0)))},e.mediaRecorder.onstop=function(){var t=e.rec_file,n=Date.now()-e.rec_start_tm,r=new Blob(e.mediaParts,{type:e.rec_blobType});(0,d.default)(r,n,(function(n){var r=Date.now();console.log("Start to save blob to webm file..."),e.writeData(t,n),console.log("Save webm file finished, elapsed: "+(Date.now()-r))}))},console.log("MediaRecorder started: "+e.rec_file),e.rec_result_cb&&e.rec_result_cb(!0)}else e.count++;e.count>=10&&(clearInterval(e.rec_timer),e.rec_timer=void 0,e.rec_result_cb&&e.rec_result_cb(!1))}),1e3)}},{key:"onRecordingStart",value:function(e){if(this.mediaRecorder&&"inactive"!=this.mediaRecorder.state)console.log("recording is in progress");else{void 0!=e&&(this.rec_threshold_single=e.rec_file_threshold,this.rec_result_cb=e.result_cb,this.rec_state_cb=e.state_cb);var t=this;navigator.webkitPersistentStorage.queryUsageAndQuota((function(e,n){""==n?(console.log("File system(sandbox) not requested."),t.requestFs()):(console.log("Used space: "+e+" bytes"),console.log("Total space: "+n+" bytes"),window.webkitRequestFileSystem(window.PERSISTENT,t.rec_threshold_total,(function(e){t._fs=e,e.root.getDirectory("ax_video",{create:!0},(function(e){console.log("Directory: "+e.name+" fs requested"),t.onRecordingProc()}),t.errorHandler)})))}),this.errorHandler)}}},{key:"onRecordingStop",value:function(){this.mediaRecorder&&"inactive"!=this.mediaRecorder.state&&(this.rec_timer&&(clearInterval(this.rec_timer),this.rec_timer=void 0),this.mediaRecorder.stop(),console.log("MediaRecorder stopped"))}},{key:"errorHandler",value:function(e){var t="An error occured(errcd): ";console.log(t+e.code)}},{key:"requestFs",value:function(){var e=this;navigator.webkitPersistentStorage.requestQuota(this.rec_threshold_total,(function(t){console.log("grantedBytes: "+t),t>0?window.webkitRequestFileSystem(window.PERSISTENT,t,(function(t){e._fs=t,t.root.getDirectory("ax_video",{create:!0},(function(t){console.log("Directory: "+t.name+" exists or just created."),e.onRecordingProc()}),e.errorHandler)})):e.rec_result_cb&&e.rec_result_cb(!1)}))}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(this.mediaType=e.mediaType,this.websocketName=e.websocketName,this.channelName=e.channelName,t){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){}},{key:"writeData",value:function(e,t){var n=this;this._fs.root.getFile("ax_video/"+e,{create:!0},(function(e){e.createWriter((function(e){e.onwriteend=function(e){},e.onerror=function(e){console.log("Write rec data failed: "+e.toString())},e.seek(e.length),e.write(t)}),n.errorHandler)}),this.errorHandler)}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onMediaSourceClose",value:function(){console.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){console.log("media source ended")}},{key:"onSBUpdateEnd",value:function(e){1===this.browserType&&(this.mediaSource.endOfStream(),this.media.play()),this.appending=!1,this.doAppending(),this.updateMediaElementDuration()}},{key:"updateMediaElementDuration",value:function(){}},{key:"onMediaSourceOpen",value:function(){console.log("media source open");var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),"FMp4"===this.mediaType&&this.checkPendingTracks(),this.wfs.trigger(o.default.MEDIA_ATTACHED,{media:this.media,channelName:this.channelName,mediaType:this.mediaType,websocketName:this.websocketName})}},{key:"checkPendingTracks",value:function(){this.createSourceBuffers({tracks:"video",mimeType:""}),this.pendingTracks={}}},{key:"onBufferReset",value:function(e){"H264Raw"===this.mediaType&&this.createSourceBuffers({tracks:"video",mimeType:e.mimeType})}},{key:"createSourceBuffers",value:function(t){var n=this.sourceBuffer,r=this.mediaSource,i=void 0;i=""===t.mimeType?"video/mp4;codecs=avc1.420028":"video/mp4;codecs="+t.mimeType;try{var a=n["video"]=r.addSourceBuffer(i);a.addEventListener("updateend",this.onsbue),t.buffer=a}catch(e){}this.wfs.trigger(o.default.BUFFER_CREATED,{tracks:t}),this.media.play()}},{key:"doAppending",value:function e(){var t=this.wfs,n=this.sourceBuffer,r=this.segments;if(Object.keys(n).length){if(this.media.error){if(this.segments=[],this.mediaErrorCount++,this.mediaErrorCount<100)console.log("trying to append although a media error occured, flush segment and abort");else{var a={type:i.ErrorTypes.MEDIA_ERROR};a.details=i.ErrorDetails.BUFFER_APPEND_ERROR,a.frag=this.fragCurrent,a.fatal=!0,this.wfs.trigger(o.default.ERROR,a)}return}if(this.mediaErrorCount=0,this.appending)return;if(r&&r.length){var s=r.shift();try{n[s.type]&&(this.parent=s.parent,n[s.type].appendBuffer(s.data),this.appendError=0,this.appended++,this.appending=!0)}catch(e){r.unshift(s);var c={type:i.ErrorTypes.MEDIA_ERROR};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,c.details=i.ErrorDetails.BUFFER_APPEND_ERROR,c.frag=this.fragCurrent,this.appendError>t.config.appendErrorMaxRetry?(r=[],c.fatal=!0):c.fatal=!1):(this.segments=[],c.details=i.ErrorDetails.BUFFER_FULL_ERROR,c.fatal=!0),this.wfs.trigger(o.default.ERROR,c)}}}}}]),t}(l.default);n.default=m},{"../errors":7,"../event-handler":8,"../events":9,"./fix-webm-duration":3}],3:[function(t,n,r){"use strict";(function(t,r){"function"===typeof e&&e.amd?e(r):"undefined"!==typeof n&&n.exports?n.exports=r():window.ysFixWebmDuration=r()})(0,(function(){var e={172351395:{name:"EBML",type:"Container"},646:{name:"EBMLVersion",type:"Uint"},759:{name:"EBMLReadVersion",type:"Uint"},754:{name:"EBMLMaxIDLength",type:"Uint"},755:{name:"EBMLMaxSizeLength",type:"Uint"},642:{name:"DocType",type:"String"},647:{name:"DocTypeVersion",type:"Uint"},645:{name:"DocTypeReadVersion",type:"Uint"},108:{name:"Void",type:"Binary"},63:{name:"CRC-32",type:"Binary"},190023271:{name:"SignatureSlot",type:"Container"},16010:{name:"SignatureAlgo",type:"Uint"},16026:{name:"SignatureHash",type:"Uint"},16037:{name:"SignaturePublicKey",type:"Binary"},16053:{name:"Signature",type:"Binary"},15963:{name:"SignatureElements",type:"Container"},15995:{name:"SignatureElementList",type:"Container"},9522:{name:"SignedElement",type:"Binary"},139690087:{name:"Segment",type:"Container"},21863284:{name:"SeekHead",type:"Container"},3515:{name:"Seek",type:"Container"},5035:{name:"SeekID",type:"Binary"},5036:{name:"SeekPosition",type:"Uint"},88713574:{name:"Info",type:"Container"},13220:{name:"SegmentUID",type:"Binary"},13188:{name:"SegmentFilename",type:"String"},1882403:{name:"PrevUID",type:"Binary"},1868715:{name:"PrevFilename",type:"String"},2013475:{name:"NextUID",type:"Binary"},1999803:{name:"NextFilename",type:"String"},1092:{name:"SegmentFamily",type:"Binary"},10532:{name:"ChapterTranslate",type:"Container"},10748:{name:"ChapterTranslateEditionUID",type:"Uint"},10687:{name:"ChapterTranslateCodec",type:"Uint"},10661:{name:"ChapterTranslateID",type:"Binary"},710577:{name:"TimecodeScale",type:"Uint"},1161:{name:"Duration",type:"Float"},1121:{name:"DateUTC",type:"Date"},15273:{name:"Title",type:"String"},3456:{name:"MuxingApp",type:"String"},5953:{name:"WritingApp",type:"String"},103:{name:"Timecode",type:"Uint"},6228:{name:"SilentTracks",type:"Container"},6359:{name:"SilentTrackNumber",type:"Uint"},39:{name:"Position",type:"Uint"},43:{name:"PrevSize",type:"Uint"},35:{name:"SimpleBlock",type:"Binary"},32:{name:"BlockGroup",type:"Container"},33:{name:"Block",type:"Binary"},34:{name:"BlockVirtual",type:"Binary"},13729:{name:"BlockAdditions",type:"Container"},38:{name:"BlockMore",type:"Container"},110:{name:"BlockAddID",type:"Uint"},37:{name:"BlockAdditional",type:"Binary"},27:{name:"BlockDuration",type:"Uint"},122:{name:"ReferencePriority",type:"Uint"},123:{name:"ReferenceBlock",type:"Int"},125:{name:"ReferenceVirtual",type:"Int"},36:{name:"CodecState",type:"Binary"},13730:{name:"DiscardPadding",type:"Int"},14:{name:"Slices",type:"Container"},104:{name:"TimeSlice",type:"Container"},76:{name:"LaceNumber",type:"Uint"},77:{name:"FrameNumber",type:"Uint"},75:{name:"BlockAdditionID",type:"Uint"},78:{name:"Delay",type:"Uint"},79:{name:"SliceDuration",type:"Uint"},72:{name:"ReferenceFrame",type:"Container"},73:{name:"ReferenceOffset",type:"Uint"},74:{name:"ReferenceTimeCode",type:"Uint"},47:{name:"EncryptedBlock",type:"Binary"},106212971:{name:"Tracks",type:"Container"},46:{name:"TrackEntry",type:"Container"},87:{name:"TrackNumber",type:"Uint"},13253:{name:"TrackUID",type:"Uint"},3:{name:"TrackType",type:"Uint"},57:{name:"FlagEnabled",type:"Uint"},8:{name:"FlagDefault",type:"Uint"},5546:{name:"FlagForced",type:"Uint"},28:{name:"FlagLacing",type:"Uint"},11751:{name:"MinCache",type:"Uint"},11768:{name:"MaxCache",type:"Uint"},254851:{name:"DefaultDuration",type:"Uint"},216698:{name:"DefaultDecodedFieldDuration",type:"Uint"},209231:{name:"TrackTimecodeScale",type:"Float"},4991:{name:"TrackOffset",type:"Int"},5614:{name:"MaxBlockAdditionID",type:"Uint"},4974:{name:"Name",type:"String"},177564:{name:"Language",type:"String"},6:{name:"CodecID",type:"String"},9122:{name:"CodecPrivate",type:"Binary"},362120:{name:"CodecName",type:"String"},13382:{name:"AttachmentLink",type:"Uint"},1742487:{name:"CodecSettings",type:"String"},1785920:{name:"CodecInfoURL",type:"String"},438848:{name:"CodecDownloadURL",type:"String"},42:{name:"CodecDecodeAll",type:"Uint"},12203:{name:"TrackOverlay",type:"Uint"},5802:{name:"CodecDelay",type:"Uint"},5819:{name:"SeekPreRoll",type:"Uint"},9764:{name:"TrackTranslate",type:"Container"},9980:{name:"TrackTranslateEditionUID",type:"Uint"},9919:{name:"TrackTranslateCodec",type:"Uint"},9893:{name:"TrackTranslateTrackID",type:"Binary"},96:{name:"Video",type:"Container"},26:{name:"FlagInterlaced",type:"Uint"},5048:{name:"StereoMode",type:"Uint"},5056:{name:"AlphaMode",type:"Uint"},5049:{name:"OldStereoMode",type:"Uint"},48:{name:"PixelWidth",type:"Uint"},58:{name:"PixelHeight",type:"Uint"},5290:{name:"PixelCropBottom",type:"Uint"},5307:{name:"PixelCropTop",type:"Uint"},5324:{name:"PixelCropLeft",type:"Uint"},5341:{name:"PixelCropRight",type:"Uint"},5296:{name:"DisplayWidth",type:"Uint"},5306:{name:"DisplayHeight",type:"Uint"},5298:{name:"DisplayUnit",type:"Uint"},5299:{name:"AspectRatioType",type:"Uint"},963876:{name:"ColourSpace",type:"Binary"},1029411:{name:"GammaValue",type:"Float"},230371:{name:"FrameRate",type:"Float"},97:{name:"Audio",type:"Container"},53:{name:"SamplingFrequency",type:"Float"},14517:{name:"OutputSamplingFrequency",type:"Float"},31:{name:"Channels",type:"Uint"},15739:{name:"ChannelPositions",type:"Binary"},8804:{name:"BitDepth",type:"Uint"},98:{name:"TrackOperation",type:"Container"},99:{name:"TrackCombinePlanes",type:"Container"},100:{name:"TrackPlane",type:"Container"},101:{name:"TrackPlaneUID",type:"Uint"},102:{name:"TrackPlaneType",type:"Uint"},105:{name:"TrackJoinBlocks",type:"Container"},109:{name:"TrackJoinUID",type:"Uint"},64:{name:"TrickTrackUID",type:"Uint"},65:{name:"TrickTrackSegmentUID",type:"Binary"},70:{name:"TrickTrackFlag",type:"Uint"},71:{name:"TrickMasterTrackUID",type:"Uint"},68:{name:"TrickMasterTrackSegmentUID",type:"Binary"},11648:{name:"ContentEncodings",type:"Container"},8768:{name:"ContentEncoding",type:"Container"},4145:{name:"ContentEncodingOrder",type:"Uint"},4146:{name:"ContentEncodingScope",type:"Uint"},4147:{name:"ContentEncodingType",type:"Uint"},4148:{name:"ContentCompression",type:"Container"},596:{name:"ContentCompAlgo",type:"Uint"},597:{name:"ContentCompSettings",type:"Binary"},4149:{name:"ContentEncryption",type:"Container"},2017:{name:"ContentEncAlgo",type:"Uint"},2018:{name:"ContentEncKeyID",type:"Binary"},2019:{name:"ContentSignature",type:"Binary"},2020:{name:"ContentSigKeyID",type:"Binary"},2021:{name:"ContentSigAlgo",type:"Uint"},2022:{name:"ContentSigHashAlgo",type:"Uint"},206814059:{name:"Cues",type:"Container"},59:{name:"CuePoint",type:"Container"},51:{name:"CueTime",type:"Uint"},55:{name:"CueTrackPositions",type:"Container"},119:{name:"CueTrack",type:"Uint"},113:{name:"CueClusterPosition",type:"Uint"},112:{name:"CueRelativePosition",type:"Uint"},50:{name:"CueDuration",type:"Uint"},4984:{name:"CueBlockNumber",type:"Uint"},106:{name:"CueCodecState",type:"Uint"},91:{name:"CueReference",type:"Container"},22:{name:"CueRefTime",type:"Uint"},23:{name:"CueRefCluster",type:"Uint"},4959:{name:"CueRefNumber",type:"Uint"},107:{name:"CueRefCodecState",type:"Uint"},155296873:{name:"Attachments",type:"Container"},8615:{name:"AttachedFile",type:"Container"},1662:{name:"FileDescription",type:"String"},1646:{name:"FileName",type:"String"},1632:{name:"FileMimeType",type:"String"},1628:{name:"FileData",type:"Binary"},1710:{name:"FileUID",type:"Uint"},1653:{name:"FileReferral",type:"Binary"},1633:{name:"FileUsedStartTime",type:"Uint"},1634:{name:"FileUsedEndTime",type:"Uint"},4433776:{name:"Chapters",type:"Container"},1465:{name:"EditionEntry",type:"Container"},1468:{name:"EditionUID",type:"Uint"},1469:{name:"EditionFlagHidden",type:"Uint"},1499:{name:"EditionFlagDefault",type:"Uint"},1501:{name:"EditionFlagOrdered",type:"Uint"},54:{name:"ChapterAtom",type:"Container"},13252:{name:"ChapterUID",type:"Uint"},5716:{name:"ChapterStringUID",type:"String"},17:{name:"ChapterTimeStart",type:"Uint"},18:{name:"ChapterTimeEnd",type:"Uint"},24:{name:"ChapterFlagHidden",type:"Uint"},1432:{name:"ChapterFlagEnabled",type:"Uint"},11879:{name:"ChapterSegmentUID",type:"Binary"},11964:{name:"ChapterSegmentEditionUID",type:"Uint"},9155:{name:"ChapterPhysicalEquiv",type:"Uint"},15:{name:"ChapterTrack",type:"Container"},9:{name:"ChapterTrackNumber",type:"Uint"},0:{name:"ChapterDisplay",type:"Container"},5:{name:"ChapString",type:"String"},892:{name:"ChapLanguage",type:"String"},894:{name:"ChapCountry",type:"String"},10564:{name:"ChapProcess",type:"Container"},10581:{name:"ChapProcessCodecID",type:"Uint"},1293:{name:"ChapProcessPrivate",type:"Binary"},10513:{name:"ChapProcessCommand",type:"Container"},10530:{name:"ChapProcessTime",type:"Uint"},10547:{name:"ChapProcessData",type:"Binary"},39109479:{name:"Tags",type:"Container"},13171:{name:"Tag",type:"Container"},9152:{name:"Targets",type:"Container"},10442:{name:"TargetTypeValue",type:"Uint"},9162:{name:"TargetType",type:"String"},9157:{name:"TagTrackUID",type:"Uint"},9161:{name:"TagEditionUID",type:"Uint"},9156:{name:"TagChapterUID",type:"Uint"},9158:{name:"TagAttachmentUID",type:"Uint"},10184:{name:"SimpleTag",type:"Container"},1443:{name:"TagName",type:"String"},1146:{name:"TagLanguage",type:"String"},1156:{name:"TagDefault",type:"Uint"},1159:{name:"TagString",type:"String"},1157:{name:"TagBinary",type:"Binary"}};function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function n(e,t){this.name=e||"Unknown",this.type=t||"Unknown"}function r(e,t){n.call(this,e,t||"Uint")}function i(e){return e.length%2===1?"0"+e:e}function a(e,t){n.call(this,e,t||"Float")}function o(e,t){n.call(this,e,t||"Container")}function s(e){o.call(this,"File","File"),this.setSource(e)}return n.prototype.updateBySource=function(){},n.prototype.setSource=function(e){this.source=e,this.updateBySource()},n.prototype.updateByData=function(){},n.prototype.setData=function(e){this.data=e,this.updateByData()},t(r,n),r.prototype.updateBySource=function(){this.data="";for(var e=0;e<this.source.length;e++){var t=this.source[e].toString(16);this.data+=i(t)}},r.prototype.updateByData=function(){var e=this.data.length/2;this.source=new Uint8Array(e);for(var t=0;t<e;t++){var n=this.data.substr(2*t,2);this.source[t]=parseInt(n,16)}},r.prototype.getValue=function(){return parseInt(this.data,16)},r.prototype.setValue=function(e){this.setData(i(e.toString(16)))},t(a,n),a.prototype.getFloatArrayType=function(){return this.source&&4===this.source.length?Float32Array:Float64Array},a.prototype.updateBySource=function(){var e=this.source.reverse(),t=this.getFloatArrayType(),n=new t(e.buffer);this.data=n[0]},a.prototype.updateByData=function(){var e=this.getFloatArrayType(),t=new e([this.data]),n=new Uint8Array(t.buffer);this.source=n.reverse()},a.prototype.getValue=function(){return this.data},a.prototype.setValue=function(e){this.setData(e)},t(o,n),o.prototype.readByte=function(){return this.source[this.offset++]},o.prototype.readUint=function(){for(var e=this.readByte(),t=8-e.toString(2).length,n=e-(1<<7-t),r=0;r<t;r++)n*=256,n+=this.readByte();return n},o.prototype.updateBySource=function(){for(this.data=[],this.offset=0;this.offset<this.source.length;this.offset=s){var t=this.readUint(),i=this.readUint(),s=Math.min(this.offset+i,this.source.length),c=this.source.slice(this.offset,s),l=e[t]||{name:"Unknown",type:"Unknown"},u=n;switch(l.type){case"Container":u=o;break;case"Uint":u=r;break;case"Float":u=a;break}var d=new u(l.name,l.type);d.setSource(c),this.data.push({id:t,idHex:t.toString(16),data:d})}},o.prototype.writeUint=function(e,t){for(var n=1,r=128;e>=r&&n<8;n++,r*=128);if(!t)for(var i=r+e,a=n-1;a>=0;a--){var o=i%256;this.source[this.offset+a]=o,i=(i-o)/256}this.offset+=n},o.prototype.writeSections=function(e){this.offset=0;for(var t=0;t<this.data.length;t++){var n=this.data[t],r=n.data.source,i=r.length;this.writeUint(n.id,e),this.writeUint(i,e),e||this.source.set(r,this.offset),this.offset+=i}return this.offset},o.prototype.updateByData=function(){var e=this.writeSections("draft");this.source=new Uint8Array(e),this.writeSections()},o.prototype.getSectionById=function(e){for(var t=0;t<this.data.length;t++){var n=this.data[t];if(n.id===e)return n.data}return null},t(s,o),s.prototype.fixDuration=function(e){var t=this.getSectionById(139690087);if(!t)return console.log("[fix-webm-duration] Segment section is missing"),!1;var n=t.getSectionById(88713574);if(!n)return console.log("[fix-webm-duration] Info section is missing"),!1;var r=n.getSectionById(710577);if(!r)return console.log("[fix-webm-duration] TimecodeScale section is missing"),!1;var i=n.getSectionById(1161);if(i){if(!(i.getValue()<=0))return console.log("[fix-webm-duration] Duration section is present"),!1;console.log("[fix-webm-duration] Duration section is present, but the value is empty"),i.setValue(e)}else console.log("[fix-webm-duration] Duration section is missing"),i=new a("Duration","Float"),i.setValue(e),n.data.push({id:1161,data:i});return r.setValue(1e6),n.updateByData(),t.updateByData(),this.updateByData(),!0},s.prototype.toBlob=function(){return new Blob([this.source.buffer],{type:"video/webm"})},function(e,n,r){try{var i=new FileReader;i.onloadend=function(){try{var t=new s(new Uint8Array(i.result));t.fixDuration(n)&&(e=t.toBlob())}catch(t){}r(e)},i.readAsArrayBuffer(e)}catch(t){r(e)}}}))},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../events"),a=l(i),o=e("../event-handler"),c=l(o);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==s(t)&&"function"!==typeof t?e:t}function f(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+s(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=function(e){function t(e){u(this,t);var n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.default.MEDIA_ATTACHED,a.default.BUFFER_CREATED,a.default.FILE_PARSING_DATA,a.default.FILE_HEAD_LOADED,a.default.FILE_DATA_LOADED,a.default.WEBSOCKET_ATTACHED,a.default.FRAG_PARSING_DATA,a.default.FRAG_PARSING_INIT_SEGMENT));return n.fileStart=0,n.fileEnd=0,n.pendingAppending=0,n.mediaType=void 0,n.channelName,n}return f(t,e),r(t,[{key:"destroy",value:function(){c.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){if(console.log("media attached"),void 0!=e.websocketName){var t="ws://"+window.location.host+"/"+e.websocketName,n="binary",r=new WebSocket(t,n);this.wfs.attachWebsocket(r,e.websocketName,e.channelName)}else console.log("websocketName ERROE!!!")}},{key:"onBufferCreated",value:function(e){this.mediaType=e.mediaType}},{key:"onFileHeadLoaded",value:function(e){}},{key:"onFileDataLoaded",value:function(e){}},{key:"onFileParsingData",value:function(e){}},{key:"onWebsocketAttached",value:function(e){this.wfs.trigger(a.default.BUFFER_APPENDING,{type:"video",data:e.payload,parent:"main"})}},{key:"onFragParsingInitSegment",value:function(e){var t,n,r=e.tracks;for(t in n=r.video,n&&(n.id=e.id),r){n=r[t];var i=n.initSegment;i&&(this.pendingAppending++,this.wfs.trigger(a.default.BUFFER_APPENDING,{type:t,data:i,parent:"main"}))}}},{key:"onFragParsingData",value:function(e){var t=this;e.type,[e.data1,e.data2].forEach((function(n){n&&(t.pendingAppending++,t.wfs.trigger(a.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main"}))}))}}]),t}(c.default);n.default=h},{"../event-handler":8,"../events":9}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../utils/logger");function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t){a(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return r(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),n=Math.min(4,this.bytesAvailable);if(0===n)throw new Error("no bytes available");t.set(this.data.subarray(e,e+n)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,r=8,i=8;for(t=0;t<e;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,n,r,i,a,o,s=0,c=0,l=0,u=0,d=1;if(this.readUByte(),e=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var f=this.readUEG();if(3===f&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(a=3!==f?8:12,o=0;o<a;o++)this.readBoolean()&&(o<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var h=this.readUEG();if(0===h)this.readUEG();else if(1===h)for(this.skipBits(1),this.skipEG(),this.skipEG(),t=this.readUEG(),o=0;o<t;o++)this.skipEG();if(this.skipUEG(),this.skipBits(1),n=this.readUEG(),r=this.readUEG(),i=this.readBits(1),0===i&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(s=this.readUEG(),c=this.readUEG(),l=this.readUEG(),u=this.readUEG()),this.readBoolean()&&this.readBoolean()){var p=void 0,y=this.readUByte();switch(y){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}p&&(d=p[0]/p[1])}return{width:Math.ceil((16*(n+1)-2*s-2*c)*d),height:(2-i)*(r+1)*16-(i?2:4)*(l+u)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=o},{"../utils/logger":16}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(e("../errors"),e("../events")),a=h(i),o=e("./exp-golomb"),c=h(o),l=e("../event-handler"),u=h(l),d=e("../remux/mp4-remuxer"),f=h(d);function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==s(t)&&"function"!==typeof t?e:t}function m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+s(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;p(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.default.H264_DATA_PARSING));r.config=r.wfs.config||n,r.wfs=e,r.id="main";MediaSource.isTypeSupported("video/mp4");return r.remuxer=new f.default(r.wfs,r.id,r.config),r.contiguous=!0,r.timeOffset=1,r.sn=0,r.TIMESCALE=9e4,r.timestamp=0,r.scaleFactor=r.TIMESCALE/1e3,r.H264_TIMEBASE=3e3,r._avcTrack={container:"video/mp4",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0},r.browserType=0,-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(r.browserType=1),r}return m(t,e),r(t,[{key:"destroy",value:function(){u.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function(){return this.timestamp+=this.H264_TIMEBASE,this.timestamp}},{key:"onH264DataParsing",value:function(e){this._parseAVCTrack(e.data),this.browserType,this.remuxer.pushVideo(0,this.sn,this._avcTrack,this.timeOffset,this.contiguous),this.sn+=1}},{key:"_parseAVCTrack",value:function(e){var t,n,r,i,o=this,s=this._avcTrack,l=s.samples,u=this._parseAVCNALu(e),d=[],f=!1,h=!1,p=0,y="",m=function(){if(d.length){if(!this.config.forceKeyFrameOnDiscontinuity||!0===h||s.sps&&(l.length||this.contiguous)){var e=this.getTimestampM();n={units:{units:d,length:p},pts:e,dts:e,key:h},l.push(n),s.len+=p,s.nbNalu+=d.length}else s.dropped++;d=[],p=0}}.bind(this);u.forEach((function(e){switch(e.type){case 1:r=!0,f&&(y+="NDR ");break;case 5:r=!0,f&&(y+="IDR "),h=!0;break;case 6:e.data=o.discardEPB(e.data),t=new c.default(e.data),t.readUByte();break;case 7:if(r=!1,f&&(y+="SPS "),!s.sps){t=new c.default(e.data);var n=t.readSPS();s.width=n.width,s.height=n.height,s.sps=[e.data],s.duration=0;var l=e.data.subarray(1,4),u="avc1.";for(i=0;i<3;i++){var g=l[i].toString(16);g.length<2&&(g="0"+g),u+=g}s.codec=u,o.wfs.trigger(a.default.BUFFER_RESET,{mimeType:s.codec}),r=!0}break;case 8:r=!1,f&&(y+="PPS "),s.pps||(s.pps=[e.data],r=!0);break;case 9:r=!1,f&&(y+="AUD "),m();break;default:r=!1,y+="unknown NAL "+e.type+" ";break}r&&(d.push(e),p+=e.data.byteLength)})),(f||y.length)&&logger.log(y),m()}},{key:"_parseAVCNALu",value:function(e){var t,n,r,i,a,o=0,s=e.byteLength,c=0,l=[];while(o<s)switch(t=e[o++],c){case 0:0===t&&(c=1);break;case 1:c=0===t?2:0;break;case 2:case 3:0===t?c=3:1===t&&o<s?(r=31&e[o],i&&(n={data:e.subarray(i,o-c-1),type:a},l.push(n)),i=o,a=r,c=0):c=0;break;default:break}return i&&(n={data:e.subarray(i,s),type:a,state:c},l.push(n)),l}},{key:"discardEPB",value:function(e){var t,n,r=e.byteLength,i=[],a=1;while(a<r-2)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var o=0;for(a=0;a<t;o++,a++)o===i[0]&&(o++,i.shift()),n[a]=e[o];return n}}]),t}(u.default);n.default=g},{"../errors":7,"../event-handler":8,"../events":9,"../remux/mp4-remuxer":15,"./exp-golomb":5}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException",NETWORK_RECV_DATA_TIMEOUT:"networkRecvDataTimeout"}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===s(Symbol.iterator)?function(e){return s(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":s(e)},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./events");o(a);function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(t){c(this,e),this.wfs=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return i(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===r(this.handledEvents)&&this.handledEvents.length&&"function"===typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function e(t,n){var r=function(e,t){var n="on"+e.replace("wfs","");return this[n],this[n].bind(this,t)};try{r.call(this,t,n).call()}catch(e){console.log("internal error happened while processing "+t+":"+e.message)}}}]),e}();n.default=l},{"./events":9}],9:[function(e,t,n){"use strict";t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",H264_DATA_PARSING:"wfsH264DataParsing",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",WEBSOCKET_MESSAGE_SENDING:"wfsWebsocketMessageSending",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData",RECORDING_START:"wfsRecordingStart",RECORDING_STOP:"wfsRecordingStop",ERROR:"wfsError"}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(){i(this,e)}return r(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();n.default=a},{}],11:[function(e,t,n){"use strict";t.exports=e("./wfs.js").default},{"./wfs.js":19}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../events"),a=l(i),o=e("../event-handler"),c=l(o);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==s(t)&&"function"!==typeof t?e:t}function f(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+s(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=function(e){function t(e){u(this,t);var n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a.default.FRAG_LOADING,a.default.FILE_HEAD_LOADING,a.default.FILE_DATA_LOADING));return n.loaders={},n}return f(t,e),r(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},c.default.prototype.destroy.call(this)}},{key:"onFileHeadLoading",value:function(e){var t=this.wfs.config,n=new t.loader(t),r=void 0,i=void 0,a=void 0;r={url:t.fmp4FileUrl},i={maxRetry:0,retryDelay:0},a={onSuccess:this.fileloadheadsuccess.bind(this)},n.loadHead(r,i,a)}},{key:"fileloadheadsuccess",value:function(e){this.wfs.trigger(a.default.FILE_HEAD_LOADED,{size:e})}},{key:"onFileDataLoading",value:function(e){var t=this.wfs.config,n=new t.loader(t),r=void 0,i=void 0,a=void 0;r={url:t.fmp4FileUrl,responseType:"arraybuffer",progressData:!1};var o=e.fileStart,s=e.fileEnd;isNaN(o)||isNaN(s)||(r.rangeStart=o,r.rangeEnd=s),i={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:t.fragLoadingMaxRetryTimeout},a={onSuccess:this.fileloaddatasuccess.bind(this)},n.load(r,i,a)}},{key:"fileloaddatasuccess",value:function(e,t,n){this.wfs.trigger(a.default.FILE_DATA_LOADED,{payload:e.data,stats:t})}},{key:"loaderror",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0}},{key:"loadtimeout",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0}},{key:"loadprogress",value:function(e,t,n){var r=t.frag;r.loaded=e.loaded}}]),t}(c.default);n.default=h},{"../event-handler":8,"../events":9}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../errors"),a=e("../events"),o=f(a),c=e("../event-handler"),l=f(c),u=e("../demux/h264-demuxer"),d=f(u);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==s(t)&&"function"!==typeof t?e:t}function y(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+s(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e){function t(e){h(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default.WEBSOCKET_ATTACHING,o.default.WEBSOCKET_DATA_UPLOADING,o.default.WEBSOCKET_MESSAGE_SENDING));return n.buf=null,n.ctx=null,n.h264Demuxer=new d.default(e),n.websocketName=void 0,n.media=void 0,n.mediaType=void 0,n.mediaCode=0,n.channelName=void 0,n.isForceClosed=!1,n.timer=void 0,n.lastRecvDataTime=0,n.extraData=void 0,n.isLoaded=!1,n.create_timer(),n}return y(t,e),r(t,[{key:"create_timer",value:function(){var e=this;this.timer=setInterval((function(){if(e.lastRecvDataTime>0){var t=performance.now(),n=t-e.lastRecvDataTime;if(n>e.wfs.config.wsMinPacketInterval&&console.log("Websocket: did not recv data over "+n+" ms"),n>e.wfs.config.wsMaxPacketInterval&&!e.isForceClosed){e.unload(),console.log("Websocket data not received in "+e.wfs.config.wsMaxPacketInterval/1e3+"s, open again...");var r={type:i.ErrorTypes.NETWORK_ERROR};r.details=i.ErrorDetails.NETWORK_RECV_DATA_TIMEOUT,r.fatal=!0,e.wfs.trigger(o.default.ERROR,r)}}else e.lastRecvDataTime=performance.now()}),this.wfs.config.wsMinPacketInterval)}},{key:"kill_timer",value:function(){this.timer&&(console.log("Websocket close: clear timer ++"),clearInterval(this.timer),this.timer=void 0,console.log("Websocket close: clear timer --"))}},{key:"destroy",value:function(){this.kill_timer(),this.isForceClosed=!0,this.client&&this.client.close(),l.default.prototype.destroy.call(this)}},{key:"onWebsocketAttaching",value:function(e){switch(e.mediaType){case"MJPEG":this.mediaCode=1,this.ctx=e.media.getContext("2d");break;case"H264Raw":default:this.mediaCode=0;break}this.websocketName=e.websocketName,this.media=e.media,this.mediaType=e.mediaType,this.channelName=e.channelName,this.extraData=e.extraData,e.websocket instanceof WebSocket&&(this.client=e.websocket,this.client.onopen=this.initSocketClient.bind(this),this.client.onclose=this.closeSocketClient.bind(this),this.client.onerror=this.errorSocketClient.bind(this))}},{key:"errorSocketClient",value:function(e){this.unload(),console.log("WebSocket error: ",e)}},{key:"closeSocketClient",value:function(e){this.unload(),console.log("Websocket closed: ",e)}},{key:"initSocketClient",value:function(e){this.load(),console.log("Websocket Open!")}},{key:"receiveSocketMessage",value:function(e){var t=this;if(!document["hidden"]&&this.isLoaded)if(this.lastRecvDataTime=performance.now(),0===this.mediaCode){this.buf=new Uint8Array(e.data);var n=new Uint8Array(this.buf);this.wfs.trigger(o.default.H264_DATA_PARSING,{data:n})}else if(1===this.mediaCode)if(this.extraData){if(!this.extraData.isDrawImg)return;if(void 0==this.media||!this.media)return;var r=new FileReader;r.onload=function(e){if(e.target.readyState===FileReader.DONE){var n=t.ctx,r=new Image,i=t.extraData.mjpeg_w,a=t.extraData.mjpeg_h,o=t.extraData.sizeOptionInd,s=t.extraData.getObjectFitSize;r.onload=function(){if(n.clearRect(0,0,i,a),1===o){var e=s(o,i,a,this.width,this.height),t=e.sx,c=e.sy,l=e.swidth,u=e.sheight,d=e.x,f=e.y,h=e.width,p=e.height;n.drawImage(r,t,c,l,u,d,f,h,p)}else n.drawImage(r,0,0,i,a)},r.src=e.target.result}},r.readAsDataURL(e.data)}else console.log("extraData is undefined"),this.extraData=this.wfs.extraData}},{key:"onWebsocketDataUploading",value:function(e){this.client.send(e.data)}},{key:"onWebsocketMessageSending",value:function(e){this.client.send(JSON.stringify({t:e.commandType,c:e.channelName,v:e.commandValue}))}},{key:"load",value:function(){0===this.mediaCode&&(this.client.binaryType="arraybuffer"),this.client.onmessage=this.receiveSocketMessage.bind(this),this.wfs.trigger(o.default.WEBSOCKET_MESSAGE_SENDING,{commandType:"open",channelName:this.channelName,commandValue:"NA"}),this.isLoaded=!0}},{key:"unload",value:function(){this.isLoaded=!1,1===this.mediaCode&&this.ctx.clearRect(0,0,this.extraData.mjpeg_w,this.extraData.mjpeg_h)}}]),t}(l.default);n.default=m},{"../demux/h264-demuxer":6,"../errors":7,"../event-handler":8,"../events":9}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(){i(this,e)}return r(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,c,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;while(i--)r+=n[i].byteLength;for(t=new Uint8Array(r),t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))}},{key:"moov",value:function(t){var n=t.length,r=[];while(n--)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){var n=t.length,r=[];while(n--)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,n){n=0;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)}},{key:"sdtp",value:function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,r,i,a=[],o=[];for(n=0;n<t.sps.length;n++)r=t.sps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)r=t.pps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),c=t.width,l=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,106,101,102,102,45,121,97,110,47,47,47,103,119,102,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var r=e.sdtp(t),i=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var r,i,a,o,s,c,l=t.samples||[],u=l.length,d=12+16*u,f=new Uint8Array(d);for(n+=8+d,f.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<u;r++)i=l[r],a=i.duration,o=i.size,s=i.flags,c=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*r);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var n,r=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+r.byteLength),n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n}}]),e}();n.default=a},{}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../helper/aac"),a=f(i),o=e("../events"),s=f(o),c=e("../utils/logger"),l=e("../remux/mp4-generator"),u=f(l),d=e("../errors");function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e("../utils/polyfill");var p=function(){function e(t,n,r){h(this,e),this.observer=t,this.id=n,this.config=r,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this.nextAvcDts=90300,this.H264_TIMEBASE=3e3,this.genISFailCount=0}return r(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1,this.genISFailCount=0}},{key:"pushVideo",value:function(e,t,n,r,i){this.level=e,this.sn=t;this.ISGenerated||this.generateVideoIS(n,r),this.ISGenerated&&this.remuxVideo_2(n,r,i)}},{key:"remuxVideo_2",value:function(e,t,n,r){var i,a,o=8,l=(this.PES_TIMESCALE,this.PES2MP4SCALEFACTOR,e.samples),d=[];i=new Uint8Array(e.len+4*e.nbNalu+8);var f=new DataView(i.buffer);f.setUint32(0,i.byteLength),i.set(u.default.types.mdat,4);for(var h=0,p=void 0,y=void 0,m=void 0,g=0;g<l.length;g++){var v=l[g],b=0;while(v.units.units.length){var w=v.units.units.shift();f.setUint32(o,w.data.byteLength),o+=4,i.set(w.data,o),o+=w.data.byteLength,b+=4+w.data.byteLength}var _=v.pts-this._initPTS,E=v.dts-this._initDTS;if(E=Math.min(_,E),void 0!==m)p=this._PTSNormalize(_,m),y=this._PTSNormalize(E,m),h=y-m,h<=0&&(c.logger.log("invalid sample duration at PTS/DTS: "+v.pts+"/"+v.dts+"|dts norm: "+y+"|lastDTS: "+m+":"+h),h=1);else{var S,T=this.nextAvcDts;p=this._PTSNormalize(_,T),y=this._PTSNormalize(E,T),T&&(S=Math.round(y-T),Math.abs(S)<600&&S&&(S>1?c.logger.log("AVC:"+S+" ms hole between fragments detected,filling it"):S<-1&&c.logger.log("AVC:"+-S+" ms overlapping between fragments detected"),y=T,p=Math.max(p-S,y),c.logger.log("Video/PTS/DTS adjusted: "+p+"/"+y+",delta:"+S))),this.firstPTS=Math.max(0,p),this.firstDTS=Math.max(0,y),h=.03}d.push({size:b,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:v.key?2:1,isNonSync:v.key?0:1}}),m=y}var A=0;d.length>=2&&(A=d[d.length-2].duration,d[0].duration=A),this.nextAvcDts=y+A;var k=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,d.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var R=d[0].flags;R.dependsOn=2,R.isNonSync=0}e.samples=d,a=u.default.moof(e.sequenceNumber++,y,e),e.samples=[];var x={id:this.id,level:this.level,sn:this.sn,data1:a,data2:i,startPTS:p,endPTS:p,startDTS:y,endDTS:y,type:"video",nb:d.length,dropped:k};return this.observer.trigger(s.default.FRAG_PARSING_DATA,x),x}},{key:"generateVideoIS",value:function(e,t){var n,r,i=this.observer,a=e.samples,o=(this.PES_TIMESCALE,{}),c={id:this.id,level:this.level,sn:this.sn,tracks:o,unique:!1},l=void 0===this._initPTS;l&&(n=r=1/0),e.sps&&e.pps&&a.length&&(e.timescale=9e4,o.video={container:"video/mp4",codec:e.codec,initSegment:u.default.initSegment([e]),metadata:{width:e.width,height:e.height}},l&&(n=Math.min(n,a[0].pts-this.H264_TIMEBASE),r=Math.min(r,a[0].dts-this.H264_TIMEBASE))),Object.keys(o).length?(i.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,c),this.ISGenerated=!0,this.genISFailCount=0,l&&(this._initPTS=n,this._initDTS=r)):(this.genISFailCount++,this.genISFailCount>60&&console.log("generateVideoIS ERROR: ",d.ErrorTypes.MEDIA_ERROR))}},{key:"remux",value:function(e,t,n,r,i,a,o,c){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(n,r,o),this.ISGenerated)if(n.samples.length){var l=this.remuxAudio(n,o,c);if(r.samples.length){var u=void 0;l&&(u=l.endPTS-l.startPTS),this.remuxVideo(r,o,c,u)}}else{var d=void 0;r.samples.length&&(d=this.remuxVideo(r,o,c)),d&&n.codec&&this.remuxEmptyAudio(n,o,c,d)}i.samples.length&&this.remuxID3(i,o),a.samples.length&&this.remuxText(a,o),this.observer.trigger(s.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n){var r,i,a=this.observer,o=e.samples,l=t.samples,f=this.PES_TIMESCALE,h={},p={id:this.id,level:this.level,sn:this.sn,tracks:h,unique:!1},y=void 0===this._initPTS;if(y&&(r=i=1/0),e.config&&o.length){if(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)){var m=function e(t,n){return n?e(n,t%n):t};e.timescale=e.audiosamplerate/m(e.audiosamplerate,1024)}c.logger.log("audio mp4 timescale :"+e.timescale),h.audio={container:"audio/mp4",codec:e.codec,initSegment:u.default.initSegment([e]),metadata:{channelCount:e.channelCount}},y&&(r=i=o[0].pts-f*n)}t.sps&&t.pps&&l.length&&(t.timescale=this.MP4_TIMESCALE,h.video={container:"video/mp4",codec:t.codec,initSegment:u.default.initSegment([t]),metadata:{width:t.width,height:t.height}},y&&(r=Math.min(r,l[0].pts-f*n),i=Math.min(i,l[0].dts-f*n))),Object.keys(h).length?(a.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,y&&(this._initPTS=r,this._initDTS=i)):a.trigger(s.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,id:this.id,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,r){var i,a,o,l,d,f,h,p=8,y=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,g=e.samples,v=[],b=void 0;b=n?this.nextAvcDts:t*y;var w=g[0];d=Math.max(this._PTSNormalize(w.dts,b)-this._initDTS,0),l=Math.max(this._PTSNormalize(w.pts,b)-this._initDTS,0);var _=Math.round((d-b)/90);n&&_&&(_>1?c.logger.log("AVC:"+_+" ms hole between fragments detected,filling it"):_<-1&&c.logger.log("AVC:"+-_+" ms overlapping between fragments detected"),d=b,g[0].dts=d+this._initDTS,l=Math.max(l-_,b),g[0].pts=l+this._initDTS,c.logger.log("Video/PTS/DTS adjusted: "+l+"/"+d+",delta:"+_)),w=g[g.length-1],h=Math.max(this._PTSNormalize(w.dts,b)-this._initDTS,0),f=Math.max(this._PTSNormalize(w.pts,b)-this._initDTS,0),f=Math.max(f,h);var E=navigator.vendor,S=navigator.userAgent,T=E&&E.indexOf("Apple")>-1&&S&&!S.match("CriOS");T&&(i=Math.round((h-d)/(m*(g.length-1))));for(var A=0;A<g.length;A++){var k=g[A];T?k.dts=d+A*m*i:(k.dts=Math.max(this._PTSNormalize(k.dts,b)-this._initDTS,d),k.dts=Math.round(k.dts/m)*m),k.pts=Math.max(this._PTSNormalize(k.pts,b)-this._initDTS,k.dts),k.pts=Math.round(k.pts/m)*m}a=new Uint8Array(e.len+4*e.nbNalu+8);var R=new DataView(a.buffer);R.setUint32(0,a.byteLength),a.set(u.default.types.mdat,4);for(var x=0;x<g.length;x++){var I=g[x],C=0,D=void 0;while(I.units.units.length){var O=I.units.units.shift();R.setUint32(p,O.data.byteLength),p+=4,a.set(O.data,p),p+=O.data.byteLength,C+=4+O.data.byteLength}if(T)D=Math.max(0,i*Math.round((I.pts-I.dts)/(m*i)));else{if(x<g.length-1)i=g[x+1].dts-I.dts;else{var U=this.config,P=I.dts-g[x>0?x-1:x].dts;if(U.stretchShortVideoTrack){var M=U.maxBufferHole,F=U.maxSeekHole,L=Math.floor(Math.min(M,F)*y),N=(r?l+r*y:this.nextAacPts)-I.pts;N>L?(i=N-P,i<0&&(i=P),c.logger.log("It is approximately "+N/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=P}else i=P}i/=m,D=Math.round((I.pts-I.dts)/m)}v.push({size:C,duration:i,cts:D,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:I.key?2:1,isNonSync:I.key?0:1}})}this.nextAvcDts=h+i*m;var B=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,v.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var G=v[0].flags;G.dependsOn=2,G.isNonSync=0}e.samples=v,o=u.default.moof(e.sequenceNumber++,d/m,e),e.samples=[];var j={id:this.id,level:this.level,sn:this.sn,data1:o,data2:a,startPTS:l/y,endPTS:(f+m*i)/y,startDTS:l/y,endDTS:(f+m*i)/y,type:"video",nb:v.length,dropped:B};return this.observer.trigger(s.default.FRAG_PARSING_DATA,j),j}},{key:"remuxAudio",value:function(e,t,n){var r,i,o,l,d,f,h,p,y,m,g,v,b,w=this.PES_TIMESCALE,_=e.timescale,E=w/_,S=1024*e.timescale/e.audiosamplerate,T=8,A=[],k=[];e.samples.sort((function(e,t){return e.pts-t.pts})),k=e.samples;for(var R=n?this.nextAacPts:t*w,x=this._PTSNormalize(k[0].pts-this._initPTS,R),I=S*E,C=x+I,D=1;D<k.length;){var O=k[D],U=this._PTSNormalize(O.pts-this._initPTS,R),P=U-C;if(P<-.5*I)c.logger.log("Dropping frame due to "+Math.abs(P/90)+" ms overlap."),k.splice(D,1),e.len-=O.unit.length;else if(P>.5*I){var M=Math.round(P/I);c.logger.log("Injecting "+M+" frame"+(M>1?"s":"")+" of missing audio due to "+Math.round(P/90)+" ms gap.");for(var F=0;F<M;F++){var L=k[D-1].pts+I,N=a.default.getSilentFrame(e.channelCount);N||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),N=O.unit.slice(0)),k.splice(D,0,{unit:N,pts:L,dts:L}),e.len+=N.length,D+=1}C+=(M+1)*I,O.pts=k[D-1].pts+I,D+=1}else Math.abs(P)>.1*I&&c.logger.log("Invalid frame delta "+(U-C+I)+" at PTS "+Math.round(U/90)+" (should be "+I+")."),C+=I,O.pts=k[D-1].pts+I,D+=1}while(k.length){if(i=k.shift(),l=i.unit,m=i.pts-this._initDTS,g=i.dts-this._initDTS,void 0!==y)v=this._PTSNormalize(m,y),b=this._PTSNormalize(g,y),o.duration=(b-y)/E;else{v=this._PTSNormalize(m,R),b=this._PTSNormalize(g,R);var B=Math.round(1e3*(v-R)/w);if(n&&B){if(B>0)c.logger.log(B+" ms hole between AAC samples detected,filling it");else if(B<-12){c.logger.log(-B+" ms overlapping between AAC samples detected, drop frame"),e.len-=l.byteLength;continue}v=b=R}if(h=Math.max(0,v),p=Math.max(0,b),!(e.len>0))return;d=new Uint8Array(e.len+8),r=new DataView(d.buffer),r.setUint32(0,d.byteLength),d.set(u.default.types.mdat,4)}d.set(l,T),T+=l.byteLength,o={size:l.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(o),y=b}var G=0,j=A.length;if(j>=2&&(G=A[j-2].duration,o.duration=G),j){this.nextAacPts=v+E*G,e.len=0,e.samples=A,f=u.default.moof(e.sequenceNumber++,p/E,e),e.samples=[];var V={id:this.id,level:this.level,sn:this.sn,data1:f,data2:d,startPTS:h/w,endPTS:this.nextAacPts/w,startDTS:p/w,endDTS:(b+E*G)/w,type:"audio",nb:j};return this.observer.trigger(s.default.FRAG_PARSING_DATA,V),V}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,r){var i=this.PES_TIMESCALE,o=e.timescale?e.timescale:e.audiosamplerate,s=i/o,l=r.startDTS*i+this._initDTS,u=r.endDTS*i+this._initDTS,d=1024,f=s*d,h=Math.ceil((u-l)/f),p=a.default.getSilentFrame(e.channelCount);if(p){for(var y=[],m=0;m<h;m++){var g=l+m*f;y.push({unit:p.slice(0),pts:g,dts:g}),e.len+=p.length}e.samples=y,this.remuxAudio(e,t,n)}else c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},{key:"remuxID3",value:function(e,t){var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(s.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort((function(e,t){return e.pts-t.pts}));var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(s.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;n=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=p},{"../errors":7,"../events":9,"../helper/aac":10,"../remux/mp4-generator":14,"../utils/logger":16,"../utils/polyfill":17}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===s(Symbol.iterator)?function(e){return s(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":s(e)};function i(){}var a={trace:i,debug:i,log:i,warn:i,info:i,error:i},o=a;function c(e,t){return t="["+e+"] > "+t,t}function l(e){var t=window.console[e];return t?function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=c(e,r[0])),t.apply(window.console,r)}:i}function u(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){o[t]=e[t]?e[t].bind(e):l(t)}))}n.enableLogs=function(t){if(!0===t||"object"===("undefined"===typeof t?"undefined":r(t))){u(t,"debug","log","info","warn","error");try{o.log()}catch(e){o=a}}else o=a},n.logger=o},{}],17:[function(e,t,n){"use strict";"undefined"===typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n=new Uint8Array(this);void 0===t&&(t=n.length);for(var r=new ArrayBuffer(t-e),i=new Uint8Array(r),a=0;a<i.length;a++)i[a]=n[a+e];return r})},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(t){i(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return r(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"loadHead",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay;var r=new XMLHttpRequest;r.open("head",e.url),r.onload=function(){n.onSuccess(r.getResponseHeader("content-length"))},r.send()}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!==typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"loadend",value:function(e){var t=e.currentTarget,n=t.status,r=this.stats,i=this.context,a=this.config;if(!r.aborted)if(window.clearTimeout(this.requestTimeout),n>=200&&n<300){r.tload=Math.max(r.tfirst,performance.now());var o=void 0,s=void 0;"arraybuffer"===i.responseType?(o=t.response,s=o.byteLength):(o=t.responseText,s=o.length),r.loaded=r.total=s;var c={url:t.responseURL,data:o};this.callbacks.onSuccess(c,r,i)}else r.retry>=a.maxRetry||n>=400&&n<499?this.callbacks.onError({code:n,text:t.statusText},i):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}},{key:"loadtimeout",value:function(){this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=a},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./errors"),a=e("./events"),o=v(a),s=e("./controller/flow-controller"),c=v(s),l=e("./controller/buffer-controller"),u=v(l),d=e("events"),f=v(d),h=e("./utils/xhr-loader"),p=v(h),y=e("./loader/file-loader"),m=(v(y),e("./loader/websocket-loader")),g=v(m);function v(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e);var n=e.DefaultConfig;for(var r in n)r in t||(t[r]=n[r]);this.config=t;var i=this.observer=new f.default;i.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e,e].concat(n))},i.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.removeListener.apply(i,[e].concat(n))},this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.flowController=new c.default(this),this.bufferController=new u.default(this),this.websocketLoader=new g.default(this),this.mediaType=void 0,this.extraData=void 0}return r(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"===typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42c01f,mp4a.40.2"')}},{key:"version",get:function(){return"v.0.0.0.1"}},{key:"Events",get:function(){return o.default}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,debug:!1,fLoader:void 0,loader:p.default,fmp4FileUrl:"xxxx.mp4",fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,forceKeyFrameOnDiscontinuity:!0,appendErrorMaxRetry:3,wsMinPacketInterval:3e3,wsMaxPacketInterval:3e4}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),r(e,[{key:"destroy",value:function(){console.log("wfs destroy +++"),this.flowController.destroy(),this.bufferController.destroy(),this.websocketLoader.destroy(),console.log("wfs destroy ---")}},{key:"attachMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"chX",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"H264Raw",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"play2",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.mediaType=n,this.media=e,this.extraData=i;var a=void 0;switch(n){case"MJPEG":a=o.default.MEDIA_ATTACHED;break;case"H264Raw":default:a=o.default.MEDIA_ATTACHING;break}this.trigger(a,{media:e,channelName:t,mediaType:n,websocketName:r,extraData:this.extraData})}},{key:"attachWebsocket",value:function(e,t,n){this.trigger(o.default.WEBSOCKET_ATTACHING,{websocket:e,websocketName:t,media:this.media,mediaType:this.mediaType,channelName:n,extraData:this.extraData})}},{key:"start_recording",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1073741824,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.trigger(o.default.RECORDING_START,{rec_file_threshold:e,result_cb:t,state_cb:n})}},{key:"stop_recording",value:function(){this.trigger(o.default.RECORDING_STOP)}}]),e}();n.default=w},{"./controller/buffer-controller":2,"./controller/flow-controller":4,"./errors":7,"./events":9,"./loader/file-loader":12,"./loader/websocket-loader":13,"./utils/xhr-loader":18,events:1}]},{},[11])(11)}))},d139:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").find,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("find",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},d58f:function(e,t,n){var r=n("1c0b"),i=n("7b0b"),a=n("44ad"),o=n("50c4"),s=function(e){return function(t,n,s,c){r(n);var l=i(t),u=a(l),d=o(l.length),f=e?d-1:0,h=e?-1:1;if(s<2)while(1){if(f in u){c=u[f],f+=h;break}if(f+=h,e?f<0:d<=f)throw TypeError("Reduce of empty array with no initial value")}for(;e?f>=0:d>f;f+=h)f in u&&(c=n(c,u[f],f,l));return c}};e.exports={left:s(!1),right:s(!0)}},d5d6:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").forEach,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("forEach",(function(e){i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},d784:function(e,t,n){"use strict";n("ac1f");var r=n("6eeb"),i=n("d039"),a=n("b622"),o=n("9263"),s=n("9112"),c=a("species"),l=!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),u=function(){return"$0"==="a".replace(/./,"$0")}(),d=a("replace"),f=function(){return!!/./[d]&&""===/./[d]("a","$0")}(),h=!i((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));e.exports=function(e,t,n,d){var p=a(e),y=!i((function(){var t={};return t[p]=function(){return 7},7!=""[e](t)})),m=y&&!i((function(){var t=!1,n=/a/;return"split"===e&&(n={},n.constructor={},n.constructor[c]=function(){return n},n.flags="",n[p]=/./[p]),n.exec=function(){return t=!0,null},n[p](""),!t}));if(!y||!m||"replace"===e&&(!l||!u||f)||"split"===e&&!h){var g=/./[p],v=n(p,""[e],(function(e,t,n,r,i){return t.exec===o?y&&!i?{done:!0,value:g.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:f}),b=v[0],w=v[1];r(String.prototype,e,b),r(RegExp.prototype,p,2==t?function(e,t){return w.call(e,this,t)}:function(e){return w.call(e,this)})}d&&s(RegExp.prototype[p],"sham",!0)}},e58c:function(e,t,n){"use strict";var r=n("fc6a"),i=n("a691"),a=n("50c4"),o=n("a640"),s=n("ae40"),c=Math.min,l=[].lastIndexOf,u=!!l&&1/[1].lastIndexOf(1,-0)<0,d=o("lastIndexOf"),f=s("indexOf",{ACCESSORS:!0,1:0}),h=u||!d||!f;e.exports=h?function(e){if(u)return l.apply(this,arguments)||0;var t=r(this),n=a(t.length),o=n-1;for(arguments.length>1&&(o=c(o,i(arguments[1]))),o<0&&(o=n+o);o>=0;o--)if(o in t&&t[o]===e)return o||0;return-1}:l},e6c4:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",{staticClass:"preview_capture_container"},[n("el-main",{staticClass:"preview_capture_left_container"},[n("el-container",{staticClass:"preview_container"},[n("el-main",{ref:"axMain",staticClass:"video_container"},[n("video",{ref:"axVideoRef",staticClass:"axVideo",attrs:{id:"myVideo",autoplay:"",muted:"",playsinline:"",oncontextmenu:"return false;"},domProps:{muted:!0}})]),n("el-footer",{staticClass:"video_controls_container",attrs:{height:"40px"}},[n("div",{staticClass:"left_controls_container"},[n("div",{staticClass:"size_option"},[n("el-dropdown",{attrs:{trigger:"click"},on:{command:e.changeSizeOption}},[n("el-button",{staticClass:"el-dropdown-link",attrs:{type:"text"}},[e._v(e._s(e.sizeOptions[e.sizeOptionInd].label))]),n("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.sizeOptions,(function(t){return n("el-dropdown-item",{key:t.id,attrs:{command:t.id+"",icon:t.icon}},[e._v(e._s(t.label))])})),1)],1)],1),n("div",{staticClass:"size_src"},[n("el-dropdown",{attrs:{trigger:"click"},on:{command:e.changeSrc}},[n("el-button",{staticClass:"el-dropdown-link",attrs:{type:"text",disabled:1==e.globalData.testMode}},[e._v(e._s(e.srcOptions[e.srcOptionInd].label))]),n("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1,disabled:1==e.globalData.testMode},slot:"dropdown"},e._l(e.srcOptions,(function(t){return n("el-dropdown-item",{key:t.id,attrs:{command:t.id+"",icon:t.icon}},[e._v(e._s(t.label))])})),1)],1)],1),n("div",[n("el-dropdown",{attrs:{trigger:"click"},on:{command:e.changeStream}},[n("el-button",{staticClass:"el-dropdown-link",attrs:{type:"text",disabled:!0}},[e._v(e._s(e.streamOptions[e.streamOptionInd].label))]),n("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1,disabled:!0},slot:"dropdown"},e._l(e.streamOptions,(function(t){return n("el-dropdown-item",{key:t.id,attrs:{command:t.id+"",icon:t.icon}},[e._v(e._s(t.label))])})),1)],1)],1)]),n("div",{staticClass:"right_controls_container"},[n("div",{staticClass:"draw_option"},[n("el-tooltip",{attrs:{effect:"dark",content:e.isRecStart?"停止录像":"开启录像",placement:"top-end",enterable:!1}},[n("el-button",{class:{draw_button_enable:!e.isRecStart,draw_button_disable:e.isRecStart},attrs:{disabled:!1===e.rec_enable,icon:"el-icon-video-camera-solid"},on:{click:e.onRecording}})],1)],1),n("div",{staticClass:"draw_option"},[n("el-tooltip",{attrs:{effect:"dark",content:e.isEnableNr?"关闭AI-3DNR":"开启AI-3DNR",placement:"top-end",enterable:!1}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],class:{draw_button_enable:e.isEnableNr,draw_button_disable:!e.isEnableNr},attrs:{icon:"el-icon-moon"},on:{click:e.changeNrEnable}})],1)],1),n("div",{staticClass:"draw_option"},[n("el-tooltip",{attrs:{effect:"dark",content:e.isTrackImg?"关闭推图":"开启推图",placement:"top-end",enterable:!1}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],class:{draw_button_enable:e.isTrackImg,draw_button_disable:!e.isTrackImg},attrs:{icon:"el-icon-view"},on:{click:e.changeTrackImg}})],1)],1),n("div",{staticClass:"draw_option"},[n("el-tooltip",{attrs:{effect:"dark",content:e.isShowRect?"隐藏检测框":"显示检测框",placement:"top-end",enterable:!1}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],class:{draw_button_enable:e.isShowRect,draw_button_disable:!e.isShowRect},attrs:{icon:"el-icon-full-screen"},on:{click:e.changeShowRect}})],1)],1),n("div",{staticClass:"full_option"},[n("el-tooltip",{attrs:{effect:"dark",content:e.isFullScreen?"退出全屏":"进入全屏",placement:"top-end",enterable:!1}},[n("el-button",{staticClass:"full_button",attrs:{icon:e.screenIcon},on:{click:e.doScreen}})],1)],1)])])],1)],1),n("el-aside",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"capture_container",attrs:{width:"315px"}},e._l(8,(function(t){return n("el-row",{key:t},[n("el-col",{class:{col_left:8!=t,col_left_last:8==t},attrs:{span:10}},[n("el-image",{attrs:{src:e.captureImages[2*(t-1)].src,"preview-src-list":[e.captureImages[2*(t-1)].src],fit:"fill"}},[n("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[n("i",{staticClass:"el-icon-picture-outline"})])])],1),n("el-col",{class:{col_right:8!=t,col_right_last:8==t},attrs:{span:10}},[n("el-image",{attrs:{src:e.captureImages[2*(t-1)+1].src,"preview-src-list":[e.captureImages[2*(t-1)+1].src],fit:"fill"}},[n("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[n("i",{staticClass:"el-icon-picture-outline"})])])],1)],1)})),1)],1)},i=[],a=(n("a4d3"),n("e01a"),n("a9e3"),n("96cf"),n("1da1")),o=n("d022"),s=n.n(o),c=n("93bf"),l=n.n(c),u={data:function(){return{captureImages:[{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""},{src:"",date:""}],sizeOptions:[{id:0,label:"自适应",value:"0:0",icon:"el-icon-full-screen"},{id:1,label:"原比例",value:"1:1",icon:"el-icon-full-screen"}],srcOptions:[{id:0,label:"视频源0",icon:"el-icon-full-screen"},{id:1,label:"视频源1",icon:"el-icon-full-screen"}],streamOptions:[{id:0,label:"主码流0",icon:"el-icon-full-screen"},{id:1,label:"子码流1",icon:"el-icon-full-screen"},{id:2,label:"子码流2",icon:"el-icon-full-screen"}],screenIcon:"vjs-icon-fullscreen-enter",sizeOptionInd:0,srcOptionInd:0,streamOptionInd:2,rec_enable:!0,isTrackImg:!0,isShowRect:!0,isEnableNr:!0,isFullScreen:!1,isRecStart:!1,isError:!1,wfsObj:null,isForceStop:!1,wsCapture:null,timer_capture:void 0,lastRecvDataTime:0,curImgInd:0,max_try_num:3}},created:function(){var e=window.localStorage.getItem("stream");this.streamOptionInd="0"===e?0:"1"===e?1:0,e=window.localStorage.getItem("src_id"),this.srcOptionInd="1"===e?1:0,e=window.localStorage.getItem("size"),this.sizeOptionInd="1"===e?1:0,"false"===window.localStorage.getItem("showrect")?this.isShowRect=!1:this.isShowRect=!0,1==this.globalData.testMode&&(this.srcOptions=[{id:0,label:"视频源0",icon:"el-icon-full-screen"}])},mounted:function(){var e=this;l.a.isEnabled&&l.a.on("change",(function(){e.checkFull()})),this.startMedia()},destroyed:function(){this.stopMedia()},methods:{startMedia:function(){this.startPlay()},stopMedia:function(){this.isForceStop=!0,this.stop(),this.stopCatpure(),l.a.off("change",(function(){}))},startPlay:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=!1,r=0;case 2:if(!(r<e.max_try_num)){t.next=19;break}if(!n){t.next=5;break}return t.abrupt("break",19);case 5:return t.prev=5,t.next=8,e.changeStream(e.streamOptionInd+"",!1,!1);case 8:e.play(),n=!0,t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](5),n=!1,r==e.max_try_num-1&&console.log("startPlay catch except: "+t.t0);case 16:r++,t.next=2;break;case 19:n||e.$message.error("网络请求码流失败");case 20:case"end":return t.stop()}}),t,null,[[5,12]])})))()},play:function(){var e=this;console.log("play ++");try{this.stop(),this.changeSizeOption(this.sizeOptionInd+"");var t=window.sessionStorage.getItem("token"),n=document.getElementById("myVideo"),r=n,i="H264Raw";s.a.isSupported()?(this.wfsObj=new s.a,this.wfsObj.attachMedia(r,"ch1",i,"ws/preview?token="+t),this.wfsObj.on(s.a.Events.ERROR,(function(t,n){return e.handleWfsEvent(t,n)})),this.isRecStart&&(this.isRecStart=!1,this.onRecording())):console.log("wfs is not supported")}catch(a){console.log("play catch except: "+a)}console.log("play --")},stop:function(){console.log("stop ++"),null!=this.wfsObj&&(this.isRecStart&&(this.wfsObj.stop_recording(),this.isError||(this.isRecStart=!1)),this.wfsObj.destroy(),this.wfsObj=null),console.log("stop --")},changeSizeOption:function(e){this.sizeOptionInd=Number(e),0===this.sizeOptionInd?document.getElementById("myVideo").style.setProperty("object-fit","fill","important"):document.getElementById("myVideo").style.setProperty("object-fit","contain","important"),console.log("old objectFit: ",document.getElementById("myVideo").style.objectFit),window.localStorage.setItem("size",this.sizeOptionInd)},changeStream:function(e){var t=arguments,n=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var i,a,o,s,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=!(t.length>1&&void 0!==t[1])||t[1],a=!(t.length>2&&void 0!==t[2])||t[2],o=Number(e),console.log("change stream to "+n.streamOptions[o].id),r.next=6,n.$http.post("preview/stream",{src:n.srcOptions[n.srcOptionInd].id,stream:n.streamOptions[o].id});case 6:if(s=r.sent,c=s.data,console.log("post stream return: ",c),c&&200===c.meta.status){r.next=11;break}return r.abrupt("return",n.$message.error("设置码流失败"));case 11:a&&(n.streamOptionInd=o,window.localStorage.setItem("src_id",n.srcOptions[n.srcOptionInd].id),window.localStorage.setItem("stream",n.streamOptions[o].id)),i&&n.play();case 13:case"end":return r.stop()}}),r)})))()},changeSrc:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.srcOptionInd=Number(e),console.log("changeSrc, srcOptionInd: "+t.srcOptionInd),n.next=4,t.changeStream(t.streamOptionInd+"");case 4:case"end":return n.stop()}}),n)})))()},changeShowRect:function(){var e=arguments,t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i,a,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=!(e.length>0&&void 0!==e[0])||e[0],!r){n.next=14;break}return console.log("show rect:"+!t.isShowRect),n.next=5,t.$http.post("preview/showrect",{showrect:!t.isShowRect});case 5:if(i=n.sent,a=i.data,console.log("post showrect return: ",a),200===a.meta.status){n.next=10;break}return n.abrupt("return",t.$message.error("设置画框失败"));case 10:t.isShowRect=!t.isShowRect,window.localStorage.setItem("showrect",t.isShowRect),n.next=22;break;case 14:return console.log("show rect:"+t.isShowRect),n.next=17,t.$http.post("preview/showrect",{showrect:t.isShowRect});case 17:if(o=n.sent,s=o.data,console.log("post showrect return: ",s),200===s.meta.status){n.next=22;break}return n.abrupt("return",t.$message.error("设置画框失败"));case 22:case"end":return n.stop()}}),n)})))()},changeTrackImg:function(){var e=arguments,t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i,a,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=!(e.length>0&&void 0!==e[0])||e[0],!r){n.next=14;break}return console.log("track img:"+!t.isTrackImg),n.next=5,t.$http.post("preview/trackimg",{trackimg:!t.isTrackImg});case 5:if(i=n.sent,a=i.data,console.log("post trackimg return: ",a),200===a.meta.status){n.next=10;break}return n.abrupt("return",t.$message.error("设置推图状态失败"));case 10:t.isTrackImg=!t.isTrackImg,window.localStorage.setItem("trackimg",t.isTrackImg),n.next=22;break;case 14:return console.log("track img:"+t.isTrackImg),n.next=17,t.$http.post("preview/trackimg",{trackimg:t.isTrackImg});case 17:if(o=n.sent,s=o.data,console.log("post trackimg return: ",s),200===s.meta.status){n.next=22;break}return n.abrupt("return",t.$message.error("设置推图状态失败"));case 22:case"end":return n.stop()}}),n)})))()},changeNrEnable:function(){var e=arguments,t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i,a,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=!(e.length>0&&void 0!==e[0])||e[0],!r){n.next=14;break}return console.log("enable nr:"+!t.isEnableNr),n.next=5,t.$http.post("preview/nr",{nr:!t.isEnableNr});case 5:if(i=n.sent,a=i.data,console.log("post enable nr return: ",a),200===a.meta.status){n.next=10;break}return n.abrupt("return",t.$message.error("设置NR状态失败"));case 10:t.isEnableNr=!t.isEnableNr,window.localStorage.setItem("nr",t.isEnableNr),n.next=22;break;case 14:return console.log("enable nr:"+t.isEnableNr),n.next=17,t.$http.post("preview/nr",{nr:t.isEnableNr});case 17:if(o=n.sent,s=o.data,console.log("post enable nr return: ",s),200===s.meta.status){n.next=22;break}return n.abrupt("return",t.$message.error("设置NR状态失败"));case 22:case"end":return n.stop()}}),n)})))()},rec_result_cb:function(e){this.rec_enable=!0,e?this.isRecStart=!0:this.$message.error("开启录像失败")},rec_state_cb:function(e){this.rec_enable=e},onRecording:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.wfsObj&&(e.isRecStart?(e.wfsObj.stop_recording(),e.isRecStart=!1):(e.rec_enable=!1,n=window.localStorage.getItem("rec_threshold_web"),void 0==n&&(n=1024),console.log("recording - threshold: "+n+" MB"),e.wfsObj.start_recording(1024*n*1024,e.rec_result_cb,e.rec_state_cb)));case 1:case"end":return t.stop()}}),t)})))()},doScreen:function(){var e=document.getElementsByClassName("preview_container")[0];this.isFullScreen?(l.a.exit(e),this.screenIcon="vjs-icon-fullscreen-enter"):(l.a.request(e),this.screenIcon="vjs-icon-fullscreen-exit"),this.isFullScreen=!this.isFullScreen},checkFull:function(){l.a.isFullscreen||(this.isFullScreen=!1,this.screenIcon="vjs-icon-fullscreen-enter")},scaleVideoTo16vs9:function(){var e=document.getElementById("myVideo");console.log("videoRatio:"+e.videoWidth+"/"+e.videoHeight)},handleWfsEvent:function(e,t){try{if(t.fatal){switch(this.isError=!0,console.warn("Fatal error :"+t.details),t.type){case s.a.ErrorTypes.MEDIA_ERROR:console.log("a media error occurred");break;case s.a.ErrorTypes.NETWORK_ERROR:console.log("a network error occurred");break;default:console.log("an unrecoverable error occurred");break}this.play()}}catch(n){console.log("handleWfsEvent catch except: "+n.description)}},startCapture:function(){var e=this;this.stopCatpure();var t=window.sessionStorage.getItem("token"),n="ws://"+window.location.host+"/ws/capture?token="+t,r="binary";this.wsCapture=new WebSocket(n,r),this.wsCapture.onopen=function(){console.log("ws capture connected"),e.create_capture_timer()},this.wsCapture.onclose=function(t){console.log("ws capture disconnected",t),e.isForceStop||e.startCapture()},this.wsCapture.onmessage=function(t){if("string"===typeof t.data)console.log("got a wscapture message: "+t.data);else{e.lastRecvDataTime=performance.now();var n=new FileReader;n.onload=function(t){if(t.target.readyState===FileReader.DONE){var n=t.target.result;e.captureImages[e.curImgInd].src=n,e.captureImages[e.curImgInd].date=e.getCurrentTime(),console.log("curImgInd: "+e.curImgInd+", "+e.captureImages[e.curImgInd].date),e.curImgInd=(e.curImgInd+1)%e.captureImages.length}},n.readAsDataURL(t.data)}},this.wsCapture.onerror=function(e){console.log("ws capture occure error",e)}},stopCatpure:function(){this.clear_capture_timer(),this.wsCapture&&this.wsCapture.close()},create_capture_timer:function(){var e=this;this.clear_capture_timer(),this.timer_capture=setInterval((function(){e.wsCapture&&e.wsCapture.send("keep-alive")}),3e3)},clear_capture_timer:function(){this.timer_capture&&(clearInterval(this.timer_capture),this.timer_capture=void 0)},getCurrentTime:function(){var e=new Date,t=this.zeroFill(e.getMonth()+1),n=this.zeroFill(e.getDate()),r=this.zeroFill(e.getHours()),i=this.zeroFill(e.getMinutes()),a=this.zeroFill(e.getSeconds()),o=e.getMilliseconds();o<=9?o="00"+o:o<=99&&(o="0"+o);var s=e.getFullYear()+"-"+t+"-"+n+"_"+r+"-"+i+"-"+a+"."+o;return s},zeroFill:function(e){return e>=0&&e<=9?"0"+e:e}}},d=u,f=(n("8aff"),n("2877")),h=Object(f["a"])(d,r,i,!1,null,"25a279e2",null);t["default"]=h.exports},e91f:function(e,t,n){"use strict";var r=n("ebb5"),i=n("4d64").indexOf,a=r.aTypedArray,o=r.exportTypedArrayMethod;o("indexOf",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},ebb5:function(e,t,n){"use strict";var r,i=n("a981"),a=n("83ab"),o=n("da84"),s=n("861d"),c=n("5135"),l=n("f5df"),u=n("9112"),d=n("6eeb"),f=n("9bf2").f,h=n("e163"),p=n("d2bb"),y=n("b622"),m=n("90e3"),g=o.Int8Array,v=g&&g.prototype,b=o.Uint8ClampedArray,w=b&&b.prototype,_=g&&h(g),E=v&&h(v),S=Object.prototype,T=S.isPrototypeOf,A=y("toStringTag"),k=m("TYPED_ARRAY_TAG"),R=i&&!!p&&"Opera"!==l(o.opera),x=!1,I={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},C=function(e){var t=l(e);return"DataView"===t||c(I,t)},D=function(e){return s(e)&&c(I,l(e))},O=function(e){if(D(e))return e;throw TypeError("Target is not a typed array")},U=function(e){if(p){if(T.call(_,e))return e}else for(var t in I)if(c(I,r)){var n=o[t];if(n&&(e===n||T.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},P=function(e,t,n){if(a){if(n)for(var r in I){var i=o[r];i&&c(i.prototype,e)&&delete i.prototype[e]}E[e]&&!n||d(E,e,n?t:R&&v[e]||t)}},M=function(e,t,n){var r,i;if(a){if(p){if(n)for(r in I)i=o[r],i&&c(i,e)&&delete i[e];if(_[e]&&!n)return;try{return d(_,e,n?t:R&&g[e]||t)}catch(s){}}for(r in I)i=o[r],!i||i[e]&&!n||d(i,e,t)}};for(r in I)o[r]||(R=!1);if((!R||"function"!=typeof _||_===Function.prototype)&&(_=function(){throw TypeError("Incorrect invocation")},R))for(r in I)o[r]&&p(o[r],_);if((!R||!E||E===S)&&(E=_.prototype,R))for(r in I)o[r]&&p(o[r].prototype,E);if(R&&h(w)!==E&&p(w,E),a&&!c(E,A))for(r in x=!0,f(E,A,{get:function(){return s(this)?this[k]:void 0}}),I)o[r]&&u(o[r],k,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:R,TYPED_ARRAY_TAG:x&&k,aTypedArray:O,aTypedArrayConstructor:U,exportTypedArrayMethod:P,exportTypedArrayStaticMethod:M,isView:C,isTypedArray:D,TypedArray:_,TypedArrayPrototype:E}},ed15:function(e,t,n){},f8cd:function(e,t,n){var r=n("a691");e.exports=function(e){var t=r(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}}}]);